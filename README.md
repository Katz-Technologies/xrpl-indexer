# XRPL Indexer Platform

–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏ –∏ –∞–Ω–∞–ª–∏–∑–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π XRP Ledger (XRPL) —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º ClickHouse –≤ –∫–∞—á–µ—Å—Ç–≤–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ –¥–∞–Ω–Ω—ã—Ö.

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

- [–û–ø–∏—Å–∞–Ω–∏–µ](#–æ–ø–∏—Å–∞–Ω–∏–µ)
- [–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏](#–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏)
- [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)
- [–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è](#—Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è)
- [–£—Å—Ç–∞–Ω–æ–≤–∫–∞](#—É—Å—Ç–∞–Ω–æ–≤–∫–∞)
- [–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è](#–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è)
- [–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ](#–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ)
- [API](#api)
- [–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞](#—Å—Ç—Ä—É–∫—Ç—É—Ä–∞-–ø—Ä–æ–µ–∫—Ç–∞)
- [–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö](#–±–∞–∑–∞-–¥–∞–Ω–Ω—ã—Ö)
- [–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞](#—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞)
- [–õ–∏—Ü–µ–Ω–∑–∏—è](#–ª–∏—Ü–µ–Ω–∑–∏—è)

## üéØ –û–ø–∏—Å–∞–Ω–∏–µ

XRPL Indexer Platform ‚Äî —ç—Ç–æ –≤—ã—Å–æ–∫–æ–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –¥–ª—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏, —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏ –∞–Ω–∞–ª–∏–∑–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π XRP Ledger. –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç:

- –†–µ–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—é —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π —á–µ—Ä–µ–∑ WebSocket –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ XRPL
- –•—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ ClickHouse –¥–ª—è –±—ã—Å—Ç—Ä—ã—Ö –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- –û–±—Ä–∞–±–æ—Ç–∫—É –¥–µ–Ω–µ–∂–Ω—ã—Ö –ø–æ—Ç–æ–∫–æ–≤ (money flows) –∏–∑ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
- REST API –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–∞–Ω–Ω—ã–º
- WebSocket API (Socket.IO) –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è –±—ç–∫—Ñ–∏–ª–ª–∏–Ω–≥–∞ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö

## ‚ú® –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

- **–ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–æ–≤—ã—Ö –ª–µ–¥–∂–µ—Ä–æ–≤ –∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π —á–µ—Ä–µ–∑ WebSocket
- **–ê–Ω–∞–ª–∏–∑ –¥–µ–Ω–µ–∂–Ω—ã—Ö –ø–æ—Ç–æ–∫–æ–≤**: –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∏ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –¥–µ–Ω–µ–∂–Ω—ã—Ö –ø–æ—Ç–æ–∫–æ–≤ –∏–∑ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π Payment, DEX, Swap –∏ –¥—Ä—É–≥–∏—Ö
- **–•—Ä–∞–Ω–µ–Ω–∏–µ –≤ ClickHouse**: –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ö–µ–º–∞ –¥–∞–Ω–Ω—ã—Ö —Å –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ–º –∏ –∏–Ω–¥–µ–∫—Å–∞–º–∏
- **REST API**: HTTP endpoints –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è—Ö –∏ –∞–∫–∫–∞—É–Ω—Ç–∞—Ö
- **Socket.IO**: WebSocket API –¥–ª—è –ø–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ —Å–æ–±—ã—Ç–∏—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- **–ë—ç–∫—Ñ–∏–ª–ª–∏–Ω–≥**: –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö
- **–û—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä**: –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –±–æ–ª—å—à–∏—Ö –¥–∏–∞–ø–∞–∑–æ–Ω–æ–≤ –ª–µ–¥–∂–µ—Ä–æ–≤

### –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º—ã–µ —Ç–∏–ø—ã —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π

- **Payment**: –ü–µ—Ä–µ–≤–æ–¥—ã XRP –∏ —Ç–æ–∫–µ–Ω–æ–≤
- **OfferCreate/OfferCancel**: DEX –æ—Ñ—Ñ–µ—Ä—ã
- **Payment + DEX**: –°–≤–æ–ø—ã —á–µ—Ä–µ–∑ DEX
- **AccountSet**: –ò–∑–º–µ–Ω–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∞–∫–∫–∞—É–Ω—Ç–∞
- –ò –¥—Ä—É–≥–∏–µ —Ç–∏–ø—ã —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π XRPL

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  XRPL Node  ‚îÇ
‚îÇ  (WebSocket)‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ
       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Main Service   ‚îÇ
‚îÇ  (Go Service)   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ
       ‚îú‚îÄ‚îÄ‚ñ∫ Producers ‚îÄ‚îÄ‚ñ∫ ClickHouse
       ‚îÇ
       ‚îú‚îÄ‚îÄ‚ñ∫ Socket.IO ‚îÄ‚îÄ‚ñ∫ WebSocket Clients
       ‚îÇ
       ‚îî‚îÄ‚îÄ‚ñ∫ REST API ‚îÄ‚îÄ‚ñ∫ HTTP Clients
```

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

1. **Main Service** (`main.go`): –û—Å–Ω–æ–≤–Ω–æ–π —Å–µ—Ä–≤–∏—Å, —É–ø—Ä–∞–≤–ª—è—é—â–∏–π –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è–º–∏ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–æ–π
2. **Producers**: –û–±—Ä–∞–±–æ—Ç–∫–∞ –ª–µ–¥–∂–µ—Ä–æ–≤ –∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π, –∑–∞–ø–∏—Å—å –≤ ClickHouse
3. **ClickHouse**: –•—Ä–∞–Ω–∏–ª–∏—â–µ –¥–∞–Ω–Ω—ã—Ö —Å –º–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–º–∏ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è–º–∏
4. **Socket.IO Hub**: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è–º–∏
5. **REST Controllers**: HTTP endpoints –¥–ª—è API
6. **Orchestrator**: –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–≥–æ –±—ç–∫—Ñ–∏–ª–ª–∏–Ω–≥–∞

## üì¶ –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

### –°–∏—Å—Ç–µ–º–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

- **Go**: –≤–µ—Ä—Å–∏—è 1.21.0 –∏–ª–∏ –≤—ã—à–µ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è 1.23.x)
- **Docker**: –¥–ª—è –∑–∞–ø—É—Å–∫–∞ ClickHouse
- **Docker Compose**: –¥–ª—è –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
- **Linux/Unix**: —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è Linux –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞

### –í–Ω–µ—à–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

- **ClickHouse**: –≤–µ—Ä—Å–∏—è 24.8 –∏–ª–∏ –≤—ã—à–µ
- **XRPL Node**: WebSocket –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –Ω–æ–¥–µ XRPL

## üöÄ –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

```bash
git clone <repository-url>
cd xrpl-indexer
```

### 2. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π Go

```bash
go mod download
```

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–∏–º–µ—Ä–∞:

```bash
cp .env.example .env
```

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `.env` —Ñ–∞–π–ª (—Å–º. —Ä–∞–∑–¥–µ–ª [–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è](#–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è)).

### 4. –ó–∞–ø—É—Å–∫ ClickHouse —á–µ—Ä–µ–∑ Docker Compose

```bash
docker-compose up -d clickhouse
```

–≠—Ç–æ –∑–∞–ø—É—Å—Ç–∏—Ç:
- ClickHouse —Å–µ—Ä–≤–µ—Ä –Ω–∞ –ø–æ—Ä—Ç–∞—Ö 9000 (native) –∏ 8123 (HTTP)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é —Å—Ö–µ–º—ã –ë–î

### 5. –°–±–æ—Ä–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞

#### Windows

```bash
go build -o .\bin\platform-server.exe .
go build -o .\bin\platform-cli.exe .\cmd\cli
go build -o .\bin\platform-orchestrator.exe .\cmd\orchestrator
go build -o .\bin\indexer-orchestrator.exe .\cmd\indexer-orchestrator
```

#### Linux

```bash
go build -o ./bin/platform-server ./
go build -o ./bin/platform-cli ./cmd/cli
go build -o ./bin/platform-orchestrator ./cmd/orchestrator
go build -o ./bin/indexer-orchestrator ./cmd/indexer-orchestrator
```

–ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ Makefile:

```bash
make build
```

–≠—Ç–æ —Å–æ–∑–¥–∞—Å—Ç –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–µ —Ñ–∞–π–ª—ã –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `bin/`:
- `bin/platform-server` / `bin/platform-server.exe` - –æ—Å–Ω–æ–≤–Ω–æ–π —Å–µ—Ä–≤–∏—Å
- `bin/platform-cli` / `bin/platform-cli.exe` - CLI –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç
- `bin/platform-orchestrator` / `bin/platform-orchestrator.exe` - –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä –¥–ª—è –±—ç–∫—Ñ–∏–ª–ª–∏–Ω–≥–∞

### 6. –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–∞

#### Windows

```bash
.\bin\platform-server.exe
.\bin\platform-cli.exe
```

#### Linux

```bash
./bin/platform-server
./bin/platform-cli
```

–ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–∫—Ä–∏–ø—Ç:

```bash
./run.sh
```

–ë—ç–∫—Ñ–∏–ª–∏–Ω–≥ —Ç–æ–∫–µ–Ω–æ–≤

```bash
./bin/platform-cli import-xrplmeta-tokens
```

–ó–∞–ø—É—Å–∫ –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏ –≤ —Ä–µ–ª–∞—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

```bash
./bin/indexer-orchestrator --server-path ./bin/platform-server --config .env
```
## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–í—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É—é—Ç—Å—è —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ —Ñ–∞–π–ª–µ `.env`.

### –û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

```env
# –°–µ—Ä–≤–µ—Ä
SERVER_HOST=0.0.0.0
SERVER_PORT=8080

# –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
LOG_LEVEL=info
LOG_TYPE=console
LOG_FILE_ENABLED=true
LOG_FILE_PATH=logs/platform.log
LOG_FILE_MAX_SIZE_MB=100
LOG_FILE_MAX_BACKUPS=3
LOG_FILE_MAX_AGE_DAYS=7

# XRPL
XRPL_WEBSOCKET_URL=wss://s1.ripple.com/
XRPL_WEBSOCKET_FULLHISTORY_URL=wss://xrplcluster.com/

# ClickHouse
CLICKHOUSE_HOST=localhost
CLICKHOUSE_PORT=9000
CLICKHOUSE_DATABASE=xrpl
CLICKHOUSE_USER=katz
CLICKHOUSE_PASSWORD=katz-password
CLICKHOUSE_BATCH_SIZE=5000
CLICKHOUSE_BATCH_TIMEOUT_MS=5000

# –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
DETAILED_LOGGING_LEDGERS=98900000,98900001,98900002
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∏ Docker Compose

–í `docker-compose.yml` –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—é—Ç—Å—è –ø–∞—Ä–∞–º–µ—Ç—Ä—ã ClickHouse:

- **CPU**: 3.6 —è–¥—Ä–∞
- **Memory**: 6.5GB –ª–∏–º–∏—Ç, 6GB —Ä–µ–∑–µ—Ä–≤
- **Ports**: 9000 (native), 8123 (HTTP)
- **Volumes**: –î–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ Docker volume `clickhouse-data`

## üìñ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ó–∞–ø—É—Å–∫ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞

```bash
# –°–±–æ—Ä–∫–∞
make build

# –ó–∞–ø—É—Å–∫
./bin/platform-server
```

–°–µ—Ä–≤–∏—Å –Ω–∞—á–Ω–µ—Ç:
1. –ü–æ–¥–∫–ª—é—á–∞—Ç—å—Å—è –∫ XRPL –Ω–æ–¥–µ —á–µ—Ä–µ–∑ WebSocket
2. –ü–æ–¥–ø–∏—Å—ã–≤–∞—Ç—å—Å—è –Ω–∞ –ø–æ—Ç–æ–∫ –ª–µ–¥–∂–µ—Ä–æ–≤
3. –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
4. –ó–∞–ø–∏—Å—ã–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ ClickHouse
5. –û—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Å–æ–±—ã—Ç–∏—è —á–µ—Ä–µ–∑ Socket.IO

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –¥–ª—è –±—ç–∫—Ñ–∏–ª–ª–∏–Ω–≥–∞

–û—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –±–æ–ª—å—à–∏–µ –¥–∏–∞–ø–∞–∑–æ–Ω—ã –ª–µ–¥–∂–µ—Ä–æ–≤:

```bash
./bin/platform-orchestrator \
  --workers 4 \
  --from 82000000 \
  --to 85000000 \
  --servers "wss://s1.ripple.com/,wss://s2.ripple.com/,wss://xrplcluster.com/" \
  --check-interval 30s \
  --verbose
```

–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:
- `--workers`: –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 2)
- `--from`: –ù–∞—á–∞–ª—å–Ω—ã–π –∏–Ω–¥–µ–∫—Å –ª–µ–¥–∂–µ—Ä–∞
- `--to`: –ö–æ–Ω–µ—á–Ω—ã–π –∏–Ω–¥–µ–∫—Å –ª–µ–¥–∂–µ—Ä–∞
- `--servers`: –°–ø–∏—Å–æ–∫ XRPL —Å–µ—Ä–≤–µ—Ä–æ–≤ —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é
- `--check-interval`: –ò–Ω—Ç–µ—Ä–≤–∞–ª –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç–∞—Ç—É—Å–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 30s)
- `--verbose`: –ü–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ó–∞–ø—É—Å–∫ –≤ —Ñ–æ–Ω–µ

#### Linux

–î–ª—è –∑–∞–ø—É—Å–∫–∞ –±—ç–∫—Ñ–∏–ª–ª–∏–Ω–≥–∞ –≤ —Ñ–æ–Ω–µ:

```bash
nohup ./run.sh > logs/backfill.log 2>&1 &
```

–î–ª—è –∑–∞–ø—É—Å–∫–∞ –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –≤ —Ñ–æ–Ω–µ:

```bash
./bin/platform-orchestrator --workers 2 --from 98900000 --to 99119667 --servers "wss://s1.ripple.com/,wss://s2.ripple.com/" --check-interval 30s --verbose --redistribute-threshold 5000 > logs/orchestrator.log 2>&1 &
```

–î–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä–∞:

```bash
touch stop.orchestrator
```

–õ–æ–≥–∏ –±—É–¥—É—Ç –∑–∞–ø–∏—Å—ã–≤–∞—Ç—å—Å—è –≤:
- `logs/orchestrator.log` - –ª–æ–≥–∏ –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä–∞
- `logs/orchestrator-worker-*.log` - –ª–æ–≥–∏ –≤–æ—Ä–∫–µ—Ä–æ–≤
- `logs/backfill.log` - –ª–æ–≥–∏ –±—ç–∫—Ñ–∏–ª–ª–∏–Ω–≥–∞

## üîå API

### REST API

#### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∞–º–∏

**–°–æ–∑–¥–∞—Ç—å —Å–≤—è–∑–∫—É –ø–æ–¥–ø–∏—Å–∫–∏:**
```http
POST /subscription-links
Content-Type: application/json

{
  "from_address": "rXXX...",
  "to_address": "rYYY..."
}
```

**–£–¥–∞–ª–∏—Ç—å —Å–≤—è–∑–∫—É –ø–æ–¥–ø–∏—Å–∫–∏:**
```http
DELETE /subscription-links
Content-Type: application/json

{
  "from_address": "rXXX...",
  "to_address": "rYYY..."
}
```

**–ü—Ä–∏–º–µ—Ä:**
```bash
curl -X POST http://localhost:8080/subscription-links \
  -H "Content-Type: application/json" \
  -d '{"from_address": "rXXX...", "to_address": "rYYY..."}'
```

#### –ü–æ–ª—É—á–∏—Ç—å –Ω–æ–≤—ã–µ —Ç–æ–∫–µ–Ω—ã

```http
GET /new-tokens?limit=100&offset=0
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `limit` (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π) - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–∫–µ–Ω–æ–≤ –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞
- `offset` (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π) - —Å–º–µ—â–µ–Ω–∏–µ –¥–ª—è –ø–∞–≥–∏–Ω–∞—Ü–∏–∏

**–ü—Ä–∏–º–µ—Ä:**
```bash
curl "http://localhost:8080/new-tokens?limit=100&offset=0"
```

#### Health Check

```http
GET /socketio/health
```

### Socket.IO API

–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ WebSocket —Å–µ—Ä–≤–µ—Ä—É:

```javascript
const socket = io('http://localhost:8080/socket.io/');

// –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –∑–∞–∫—Ä—ã—Ç–∏–µ –ª–µ–¥–∂–µ—Ä–æ–≤
socket.on('ledger_closed', (data) => {
  console.log('New ledger:', data);
  // {
  //   ledger_index: 12345678,
  //   ledger_hash: "...",
  //   txn_count: 42,
  //   timestamp: 1234567890
  // }
});

// –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
socket.on('transaction', (data) => {
  console.log('New transaction:', data);
});
```

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
xrpl-indexer/
‚îú‚îÄ‚îÄ bin/                    # –°–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –±–∏–Ω–∞—Ä–Ω–∏–∫–∏
‚îú‚îÄ‚îÄ clickhouse/
‚îÇ   ‚îú‚îÄ‚îÄ config/             # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è ClickHouse
‚îÇ   ‚îî‚îÄ‚îÄ ddl/                # SQL —Å—Ö–µ–º—ã
‚îÇ       ‚îî‚îÄ‚îÄ 001_init.sql    # –û—Å–Ω–æ–≤–Ω–∞—è —Å—Ö–µ–º–∞ –ë–î
‚îú‚îÄ‚îÄ cmd/
‚îÇ   ‚îú‚îÄ‚îÄ cli/                # CLI –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç
‚îÇ   ‚îú‚îÄ‚îÄ orchestrator/       # –û—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä –±—ç–∫—Ñ–∏–ª–ª–∏–Ω–≥–∞
‚îÇ   ‚îî‚îÄ‚îÄ indexer-orchestrator/  # –û—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä –∏–Ω–¥–µ–∫—Å–µ—Ä–∞
‚îú‚îÄ‚îÄ config/                 # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ env.go              # –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ connections/            # –ü–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –≤–Ω–µ—à–Ω–∏–º —Å–µ—Ä–≤–∏—Å–∞–º
‚îú‚îÄ‚îÄ consumers/              # Consumers (—É—Å—Ç–∞—Ä–µ–ª–æ)
‚îú‚îÄ‚îÄ controllers/            # HTTP –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã
‚îÇ   ‚îú‚îÄ‚îÄ new-token-controller.go
‚îÇ   ‚îî‚îÄ‚îÄ subscription-controller.go
‚îú‚îÄ‚îÄ indexer/                # –õ–æ–≥–∏–∫–∞ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ logger/                 # –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
‚îú‚îÄ‚îÄ models/                 # –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö
‚îú‚îÄ‚îÄ producers/              # –û–±—Ä–∞–±–æ—Ç–∫–∞ –ª–µ–¥–∂–µ—Ä–æ–≤ –∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
‚îÇ   ‚îú‚îÄ‚îÄ ledger.go
‚îÇ   ‚îú‚îÄ‚îÄ transaction.go
‚îÇ   ‚îî‚îÄ‚îÄ validation.go
‚îú‚îÄ‚îÄ responses/              # HTTP –æ—Ç–≤–µ—Ç—ã
‚îú‚îÄ‚îÄ routes/                 # –ú–∞—Ä—à—Ä—É—Ç—ã API
‚îÇ   ‚îî‚îÄ‚îÄ routes.go
‚îú‚îÄ‚îÄ signals/                # –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–∏–≥–Ω–∞–ª–æ–≤ –û–°
‚îú‚îÄ‚îÄ socketio/               # Socket.IO hub
‚îú‚îÄ‚îÄ docker-compose.yml      # Docker Compose –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ go.mod                  # Go –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ go.sum                  # Go checksums
‚îú‚îÄ‚îÄ main.go                 # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îú‚îÄ‚îÄ Makefile                # Make –∫–æ–º–∞–Ω–¥—ã
‚îî‚îÄ‚îÄ run.sh                  # –°–∫—Ä–∏–ø—Ç –∑–∞–ø—É—Å–∫–∞ –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä–∞
```

## üóÑÔ∏è –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

### –°—Ö–µ–º–∞ ClickHouse

–ü—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç ClickHouse –≤–µ—Ä—Å–∏–∏ 24.8+ —Å –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Å—Ö–µ–º–æ–π –¥–∞–Ω–Ω—ã—Ö.

#### –û—Å–Ω–æ–≤–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã

**`xrpl.money_flow`**
- –•—Ä–∞–Ω–∏—Ç –¥–µ–Ω–µ–∂–Ω—ã–µ –ø–æ—Ç–æ–∫–∏ –∏–∑ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
- –ü–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ –º–µ—Å—è—Ü–∞–º (`toYYYYMM(close_time)`)
- –ò–Ω–¥–µ–∫—Å—ã –ø–æ –∞–¥—Ä–µ—Å–∞–º, –≤–∞–ª—é—Ç–∞–º, —Ç–∏–ø–∞–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `ReplacingMergeTree` –¥–ª—è –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏

**`xrpl.empty_ledgers`**
- –•—Ä–∞–Ω–∏—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ª–µ–¥–∂–µ—Ä–∞—Ö –±–µ–∑ Payment —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∑–∞–ø—Ä–æ—Å–æ–≤

**`xrpl.xrp_prices`**
- –•—Ä–∞–Ω–∏—Ç –∏—Å—Ç–æ—Ä–∏—é —Ü–µ–Ω XRP –≤ USD
- –ü–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ –º–µ—Å—è—Ü–∞–º


### –ó–∞–ø—Ä–æ—Å—ã –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

–ü—Ä–∏–º–µ—Ä—ã –ø–æ–ª–µ–∑–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤:

```sql
-- –ü–æ–ª—É—á–∏—Ç—å –¥–µ–Ω–µ–∂–Ω—ã–µ –ø–æ—Ç–æ–∫–∏ –¥–ª—è –∞–¥—Ä–µ—Å–∞
SELECT * FROM xrpl.money_flow
WHERE from_address = 'r...' OR to_address = 'r...'
ORDER BY close_time DESC
LIMIT 100;

-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ç–∏–ø–∞–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
SELECT kind, count() as count
FROM xrpl.money_flow
WHERE close_time >= now() - INTERVAL 1 DAY
GROUP BY kind;

-- –¢–æ–ø –∞–¥—Ä–µ—Å–æ–≤ –ø–æ –æ–±—ä–µ–º—É —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
SELECT 
  to_address,
  sum(to_amount) as total_received
FROM xrpl.money_flow
WHERE to_currency = 'XRP'
  AND close_time >= now() - INTERVAL 7 DAY
GROUP BY to_address
ORDER BY total_received DESC
LIMIT 10;
```

## üõ†Ô∏è –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –°–±–æ—Ä–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞

```bash
# –°–±–æ—Ä–∫–∞ –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
make build

# –û—á–∏—Å—Ç–∫–∞
make clean
```

### –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

```bash
go test ./...
```

### –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞

```bash
go fmt ./...
```

### –õ–∏–Ω—Ç–∏–Ω–≥

```bash
golangci-lint run
```

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ç–∏–ø–æ–≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π

1. –î–æ–±–∞–≤—å—Ç–µ –æ–±—Ä–∞–±–æ—Ç–∫—É –≤ `producers/transaction.go`
2. –û–±–Ω–æ–≤–∏—Ç–µ –º–æ–¥–µ–ª—å –≤ `models/`
3. –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –æ–±–Ω–æ–≤–∏—Ç–µ —Å—Ö–µ–º—É –ë–î –≤ `clickhouse/ddl/`

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–ü—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `zerolog` –¥–ª—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è. –£—Ä–æ–≤–Ω–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è:
- `debug`: –î–µ—Ç–∞–ª—å–Ω–∞—è –æ—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
- `info`: –û–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
- `warn`: –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è
- `error`: –û—à–∏–±–∫–∏

–î–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –ª–µ–¥–∂–µ—Ä–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è:
```env
DETAILED_LOGGING_LEDGERS=98900000,98900001
```

## üèõÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

–ü—Ä–æ–µ–∫—Ç —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ 4 –æ—Å–Ω–æ–≤–Ω—ã—Ö –±–∏–Ω–∞—Ä–Ω–∏–∫–æ–≤, –∫–∞–∂–¥—ã–π –∏–∑ –∫–æ—Ç–æ—Ä—ã—Ö –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Å–≤–æ—é —Ä–æ–ª—å –≤ —Å–∏—Å—Ç–µ–º–µ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏ XRPL:

1. **–ü—Ä–æ—Ü–µ—Å—Å –±—ç–∫—Ñ–∏–ª–∏–Ω–≥–∞** (`platform-cli backfill`) - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –ª–µ–¥–∂–µ—Ä–æ–≤
2. **–û—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä –±—ç–∫—Ñ–∏–ª–∏–Ω–≥–∞** (`platform-orchestrator`) - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–º–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏ –±—ç–∫—Ñ–∏–ª–∏–Ω–≥–∞
3. **–ü—Ä–æ—Ü–µ—Å—Å –∏–Ω–¥–µ–∫—Å–µ—Ä–∞** (`platform-server`) - –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è –ª–µ–¥–∂–µ—Ä–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
4. **–û—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä –∏–Ω–¥–µ–∫—Å–µ—Ä–∞** (`indexer-orchestrator`) - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ—Ç–æ–∫–∞–º–∏ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

---

### 1. –ü—Ä–æ—Ü–µ—Å—Å –±—ç–∫—Ñ–∏–ª–∏–Ω–≥–∞ (`platform-cli backfill`)

**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `cmd/cli/backfill.go`  
**–ë–∏–Ω–∞—Ä–Ω–∏–∫:** `bin/platform-cli.exe` (Windows) / `bin/platform-cli` (Linux)  
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –ª–µ–¥–∂–µ—Ä–æ–≤ XRPL —Å –∑–∞–ø–∏—Å—å—é –¥–∞–Ω–Ω—ã—Ö –≤ ClickHouse

#### –û–±–∑–æ—Ä —Ä–∞–±–æ—Ç—ã

–ü—Ä–æ—Ü–µ—Å—Å –±—ç–∫—Ñ–∏–ª–∏–Ω–≥–∞ –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö –æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è—Ö XRPL. –û–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ —Ä–µ–∂–∏–º–µ "–æ–¥–∏–Ω –ª–µ–¥–∂–µ—Ä –∑–∞ —Ä–∞–∑", –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É—è –ø–æ–ª–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É –∫–∞–∂–¥–æ–≥–æ –ª–µ–¥–∂–µ—Ä–∞ –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ—Ö–æ–¥–æ–º –∫ —Å–ª–µ–¥—É—é—â–µ–º—É.

#### –û—Å–Ω–æ–≤–Ω–æ–π –∞–ª–≥–æ—Ä–∏—Ç–º —Ä–∞–±–æ—Ç—ã

```
1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
   ‚îú‚îÄ‚îÄ –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∏–∑ .env —Ñ–∞–π–ª–∞
   ‚îú‚îÄ‚îÄ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ ClickHouse
   ‚îú‚îÄ‚îÄ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ XRPL —Å–µ—Ä–≤–µ—Ä—É (WebSocket + RPC)
   ‚îî‚îÄ‚îÄ –ü–∞—Ä—Å–∏–Ω–≥ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏

2. –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –ª–µ–¥–∂–µ—Ä–æ–≤ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏
   ‚îú‚îÄ‚îÄ –í–∞—Ä–∏–∞–Ω—Ç A: –î–∏–∞–ø–∞–∑–æ–Ω (--from N --to M)
   ‚îú‚îÄ‚îÄ –í–∞—Ä–∏–∞–Ω—Ç B: –°–ø–∏—Å–æ–∫ (--ledgers "N1,N2,N3")
   ‚îî‚îÄ‚îÄ –í–∞—Ä–∏–∞–Ω—Ç C: –§–∞–π–ª (--ledgers-file path/to/file.txt)

3. –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ª–µ–¥–∂–µ—Ä–æ–≤
   –î–ª—è –∫–∞–∂–¥–æ–≥–æ –ª–µ–¥–∂–µ—Ä–∞:
   ‚îú‚îÄ‚îÄ processLedgerWithInfiniteRetry(ledgerIndex)
   ‚îÇ   ‚îú‚îÄ‚îÄ –ë–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π —Ü–∏–∫–ª –ø–æ–≤—Ç–æ—Ä–æ–≤ –¥–æ —É—Å–ø–µ—Ö–∞
   ‚îÇ   ‚îú‚îÄ‚îÄ backfillLedgerWithRetry(ledgerIndex)
   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ backfillTransactionsWithRetry(ledgerJSON)
   ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ backfillTransactions(ledgerJSON)
   ‚îÇ   ‚îÇ           ‚îú‚îÄ‚îÄ FetchTransactions() - –ø–æ–ª—É—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ XRPL RPC
   ‚îÇ   ‚îÇ           ‚îú‚îÄ‚îÄ –î–ª—è –∫–∞–∂–¥–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏:
   ‚îÇ   ‚îÇ           ‚îÇ   ‚îú‚îÄ‚îÄ –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è: —Ç–æ–ª—å–∫–æ Payment —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
   ‚îÇ   ‚îÇ           ‚îÇ   ‚îú‚îÄ‚îÄ ProcessTransaction() - –æ–±—Ä–∞–±–æ—Ç–∫–∞
   ‚îÇ   ‚îÇ           ‚îÇ   ‚îî‚îÄ‚îÄ –ó–∞–ø–∏—Å—å –≤ ClickHouse (–±–∞—Ç—á–∏–Ω–≥)
   ‚îÇ   ‚îÇ           ‚îî‚îÄ‚îÄ RecordEmptyLedger() - –µ—Å–ª–∏ –Ω–µ—Ç Payment —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
   ‚îÇ   ‚îî‚îÄ‚îÄ –°–æ–±–ª—é–¥–µ–Ω–∏–µ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–∏ –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏
   ‚îî‚îÄ‚îÄ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ (–∫–∞–∂–¥—ã–µ 100 –ª–µ–¥–∂–µ—Ä–æ–≤)

4. –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ
   ‚îú‚îÄ‚îÄ FlushClickHouse() - —Ñ–∏–Ω–∞–ª—å–Ω–∞—è –∑–∞–ø–∏—Å—å –≤—Å–µ—Ö –±–∞—Ç—á–µ–π
   ‚îî‚îÄ‚îÄ –ó–∞–∫—Ä—ã—Ç–∏–µ –≤—Å–µ—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
```

#### –ö–ª—é—á–µ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

**1. –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –ª–µ–¥–∂–µ—Ä–∞**

–ü—Ä–æ—Ü–µ—Å—Å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç XRPL RPC –∫–æ–º–∞–Ω–¥—É `ledger` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –≤—Å–µ—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ª–µ–¥–∂–µ—Ä–∞:

```go
// models/ledger.go
ledger.FetchTransactions()
  ‚îî‚îÄ‚îÄ XRPL RPC –∑–∞–ø—Ä–æ—Å: {"command": "ledger", "ledger_index": N, "transactions": true, "expand": true}
```

–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –æ—Ç–¥–µ–ª—å–Ω—ã–π RPC –∫–ª–∏–µ–Ω—Ç (–Ω–µ WebSocket stream)
- –¢–∞–π–º–∞—É—Ç –∑–∞–ø—Ä–æ—Å–∞: 60 —Å–µ–∫—É–Ω–¥
- –≠–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π backoff –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö (–¥–æ 5 –ø–æ–ø—ã—Ç–æ–∫)
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –ø–µ—Ä–µ–¥ –∑–∞–ø—Ä–æ—Å–æ–º

**2. –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π**

–ö–∞–∂–¥–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è —Ñ—É–Ω–∫—Ü–∏–µ–π `consumers.ProcessTransaction()`:

```go
// consumers/consumers.go
ProcessTransaction(tx map[string]interface{})
  ‚îú‚îÄ‚îÄ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (—Ç–æ–ª—å–∫–æ "Payment")
  ‚îú‚îÄ‚îÄ indexer.ModifyTransaction() - –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
  ‚îú‚îÄ‚îÄ ExtractBalanceChanges() - –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –±–∞–ª–∞–Ω—Å–æ–≤
  ‚îÇ   ‚îî‚îÄ‚îÄ –ü–∞—Ä—Å–∏–Ω–≥ meta.AffectedNodes:
  ‚îÇ       ‚îú‚îÄ‚îÄ AccountRoot - –∏–∑–º–µ–Ω–µ–Ω–∏—è XRP –±–∞–ª–∞–Ω—Å–æ–≤
  ‚îÇ       ‚îú‚îÄ‚îÄ RippleState - –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–æ–≤ (IOU)
  ‚îÇ       ‚îî‚îÄ‚îÄ –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–æ–≤ –∏–∑–º–µ–Ω–µ–Ω–∏–π (Fee, Burn, Payout, Transfer, Swap)
  ‚îú‚îÄ‚îÄ BuildActionGroups() - –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –¥–µ–π—Å—Ç–≤–∏—è
  ‚îÇ   ‚îî‚îÄ‚îÄ –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ —Å–≤—è–∑–æ–∫:
  ‚îÇ       ‚îú‚îÄ‚îÄ Transfer: –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—å ‚Üí –ø–æ–ª—É—á–∞—Ç–µ–ª—å
  ‚îÇ       ‚îú‚îÄ‚îÄ Swap: –æ–±–º–µ–Ω –≤–∞–ª—é—Ç —É –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è
  ‚îÇ       ‚îú‚îÄ‚îÄ DexOffer: DEX –æ–ø–µ—Ä–∞—Ü–∏–∏ —É –ø–æ—Å—Ä–µ–¥–Ω–∏–∫–æ–≤
  ‚îÇ       ‚îú‚îÄ‚îÄ Fee: –∫–æ–º–∏—Å—Å–∏—è —Å–µ—Ç–∏
  ‚îÇ       ‚îú‚îÄ‚îÄ Burn: —Å–∂–∏–≥–∞–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤
  ‚îÇ       ‚îî‚îÄ‚îÄ Payout: –≤—ã–¥–∞—á–∞ —Ç–æ–∫–µ–Ω–æ–≤ —ç–º–∏—Ç–µ–Ω—Ç–æ–º
  ‚îî‚îÄ‚îÄ –ó–∞–ø–∏—Å—å –∫–∞–∂–¥–æ–π action –≤ ClickHouse –∫–∞–∫ money_flow —Å—Ç—Ä–æ–∫–∞
```

**3. –ó–∞–ø–∏—Å—å –≤ ClickHouse**

–î–∞–Ω–Ω—ã–µ –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ –±–∞—Ç—á–∏–Ω–≥ –º–µ—Ö–∞–Ω–∏–∑–º:

```go
// connections/clickhouse.go
WriteMoneyFlowRow(...)
  ‚îî‚îÄ‚îÄ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ in-memory –±–∞—Ç—á
      ‚îî‚îÄ‚îÄ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–ø–∏—Å—å –ø—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ CLICKHOUSE_BATCH_SIZE (5000 —Å—Ç—Ä–æ–∫)
      ‚îî‚îÄ‚îÄ –ò–ª–∏ –ø—Ä–∏ —Ç–∞–π–º–∞—É—Ç–µ CLICKHOUSE_BATCH_TIMEOUT_MS (5000 –º—Å)
```

**4. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏ –ø–æ–≤—Ç–æ—Ä—ã**

–ü—Ä–æ—Ü–µ—Å—Å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –º–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤—É—é —Å–∏—Å—Ç–µ–º—É –ø–æ–≤—Ç–æ—Ä–æ–≤:

- **–£—Ä–æ–≤–µ–Ω—å 1: –ü–æ–≤—Ç–æ—Ä –∑–∞–ø—Ä–æ—Å–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π** (–¥–æ 3 –ø–æ–ø—ã—Ç–æ–∫)
  - –≠–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π backoff: 1s, 2s, 4s
  - –ü–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ RPC –∫–ª–∏–µ–Ω—Ç–∞ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è

- **–£—Ä–æ–≤–µ–Ω—å 2: –ü–æ–≤—Ç–æ—Ä –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ª–µ–¥–∂–µ—Ä–∞** (–±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–µ –ø–æ–≤—Ç–æ—Ä—ã)
  - –≠–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π backoff: 1s ‚Üí 2s ‚Üí 4s ‚Üí ... ‚Üí 30s (–º–∞–∫—Å–∏–º—É–º)
  - –°–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞:
    - IP limit –æ—à–∏–±–∫–∏: –æ–∂–∏–¥–∞–Ω–∏–µ 5 –º–∏–Ω—É—Ç
    - WebSocket –æ—à–∏–±–∫–∏: –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–æ–≤
    - –¢–∞–π–º–∞—É—Ç—ã (>35 —Å–µ–∫—É–Ω–¥): –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞–∫ "hung request"

#### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏

```bash
platform-cli backfill \
  --from 82000000 \              # –ù–∞—á–∞–ª—å–Ω—ã–π –∏–Ω–¥–µ–∫—Å –ª–µ–¥–∂–µ—Ä–∞
  --to 82001000 \                # –ö–æ–Ω–µ—á–Ω—ã–π –∏–Ω–¥–µ–∫—Å –ª–µ–¥–∂–µ—Ä–∞
  --ledgers "100,200,300" \      # –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: —Å–ø–∏—Å–æ–∫ –ª–µ–¥–∂–µ—Ä–æ–≤
  --ledgers-file path.txt \      # –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: —Ñ–∞–π–ª —Å –ª–µ–¥–∂–µ—Ä–∞–º–∏
  --server wss://xrplcluster.com/ \  # XRPL —Å–µ—Ä–≤–µ—Ä (–∏–ª–∏ –∏–∑ .env)
  --delay 100 \                  # –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏ (–º—Å)
  --config .env \                # –§–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
  --verbose                      # –ü–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
```

#### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

- `BACKFILL_MIN_DELAY_MS` - –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏ (–ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç --delay)
- `XRPL_WEBSOCKET_FULLHISTORY_URL` - URL XRPL —Å–µ—Ä–≤–µ—Ä–∞ –¥–ª—è –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö
- `DETAILED_LOGGING_LEDGERS` - —Å–ø–∏—Å–æ–∫ –ª–µ–¥–∂–µ—Ä–æ–≤ –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

#### –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

1. **–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞**: –õ–µ–≥–¥–∂–µ—Ä—ã –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è —Å—Ç—Ä–æ–≥–æ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ, –±–µ–∑ –ø—Ä–æ–ø—É—Å–∫–æ–≤. –ö–∞–∂–¥—ã–π –ª–µ–¥–∂–µ—Ä –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —É—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ—Ö–æ–¥–æ–º –∫ —Å–ª–µ–¥—É—é—â–µ–º—É.

2. **–ë–µ—Å–∫–æ–Ω–µ—á–Ω—ã–µ –ø–æ–≤—Ç–æ—Ä—ã**: –ü—Ä–æ—Ü–µ—Å—Å –Ω–µ –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç –ª–µ–¥–∂–µ—Ä—ã –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö. –ö–∞–∂–¥—ã–π –ª–µ–¥–∂–µ—Ä –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –¥–æ —É—Å–ø–µ—à–Ω–æ–≥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è, —á—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –ø–æ–ª–Ω–æ—Ç—É –¥–∞–Ω–Ω—ã—Ö.

3. **–°–æ–±–ª—é–¥–µ–Ω–∏–µ rate limits**: –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ª–µ–¥–∂–µ—Ä–∞ –ø—Ä–æ—Ü–µ—Å—Å –∂–¥–µ—Ç –º–∏–Ω–∏–º—É–º `--delay` –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥ –ø–µ—Ä–µ–¥ —Å–ª–µ–¥—É—é—â–∏–º –∑–∞–ø—Ä–æ—Å–æ–º, —á—Ç–æ–±—ã –Ω–µ –ø–µ—Ä–µ–≥—Ä—É–∂–∞—Ç—å XRPL —Å–µ—Ä–≤–µ—Ä.

4. **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π**: –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —Ç–∏–ø–∞ "Payment" —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º "tesSUCCESS". –û—Å—Ç–∞–ª—å–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –ø—Ä–æ–ø—É—Å–∫–∞—é—Ç—Å—è.

5. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—É—Å—Ç—ã—Ö –ª–µ–¥–∂–µ—Ä–æ–≤**: –ï—Å–ª–∏ –≤ –ª–µ–¥–∂–µ—Ä–µ –Ω–µ—Ç —É—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö Payment —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π, –ª–µ–¥–∂–µ—Ä –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –≤ —Ç–∞–±–ª–∏—Ü—É `empty_ledgers` –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –±—É–¥—É—â–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤.

6. **–ë–∞—Ç—á–∏–Ω–≥**: –î–∞–Ω–Ω—ã–µ –Ω–∞–∫–∞–ø–ª–∏–≤–∞—é—Ç—Å—è –≤ –ø–∞–º—è—Ç–∏ –∏ –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –≤ ClickHouse –±–∞—Ç—á–∞–º–∏, —á—Ç–æ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ –ø–æ–≤—ã—à–∞–µ—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å.

#### –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

**–ë–∞–∑–æ–≤—ã–π –±—ç–∫—Ñ–∏–ª–ª–∏–Ω–≥ –¥–∏–∞–ø–∞–∑–æ–Ω–∞:**
```bash
./bin/platform-cli backfill --from 82000000 --to 82001000
```

**–ë—ç–∫—Ñ–∏–ª–ª–∏–Ω–≥ –∏–∑ —Ñ–∞–π–ª–∞:**
```bash
./bin/platform-cli backfill --ledgers-file missing_ledgers.txt
```

**–ë—ç–∫—Ñ–∏–ª–ª–∏–Ω–≥ —Å –∫–∞—Å—Ç–æ–º–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π:**
```bash
BACKFILL_MIN_DELAY_MS=200 ./bin/platform-cli backfill --from 82000000 --to 82001000
```

#### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–ü—Ä–æ—Ü–µ—Å—Å –ª–æ–≥–∏—Ä—É–µ—Ç:
- –ü—Ä–æ–≥—Ä–µ—Å—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏ (–∫–∞–∂–¥—ã–µ 100 –ª–µ–¥–∂–µ—Ä–æ–≤)
- –û—à–∏–±–∫–∏ —Å –¥–µ—Ç–∞–ª—è–º–∏ –ø–æ–≤—Ç–æ—Ä–æ–≤
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ –∫–∞–∂–¥–æ–º—É –ª–µ–¥–∂–µ—Ä—É (–æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ/–ø—Ä–æ–ø—É—â–µ–Ω–æ/–æ—à–∏–±–æ–∫)
- –í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–∞–∂–¥–æ–≥–æ –ª–µ–¥–∂–µ—Ä–∞

–ü—Ä–∏–º–µ—Ä –ª–æ–≥–∞:
```
[BACKFILL] Starting backfill process from ledger 82000000 to 82001000
[BACKFILL] Progress: 1.0% (100/1000) - Processing ledger 82000100
[BACKFILL] Successfully processed ledger 82000100 in 2.3s (attempt 1)
[BACKFILL] Ledger 82000100 processing summary: total=42, processed=15, skipped=27, errors=0
```

---

### 2. –û—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä –±—ç–∫—Ñ–∏–ª–∏–Ω–≥–∞ (`platform-orchestrator`)

**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `cmd/orchestrator/`  
**–ë–∏–Ω–∞—Ä–Ω–∏–∫:** `bin/platform-orchestrator.exe` (Windows) / `bin/platform-orchestrator` (Linux)  
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–º–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏ –±—ç–∫—Ñ–∏–ª–∏–Ω–≥–∞ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –ø–µ—Ä–µ—Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ–º —Ä–∞–±–æ—Ç—ã –∏ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ–º –ø—Ä–æ–ø—É—Å–∫–æ–≤

#### –û–±–∑–æ—Ä —Ä–∞–±–æ—Ç—ã

–û—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä –±—ç–∫—Ñ–∏–ª–∏–Ω–≥–∞ - —ç—Ç–æ –º–µ–Ω–µ–¥–∂–µ—Ä –ø—Ä–æ—Ü–µ—Å—Å–æ–≤, –∫–æ—Ç–æ—Ä—ã–π –∫–æ–æ—Ä–¥–∏–Ω–∏—Ä—É–µ—Ç —Ä–∞–±–æ—Ç—É –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –±—ç–∫—Ñ–∏–ª–∏–Ω–≥–∞ (`platform-cli backfill`). –û–Ω —Ä–µ—à–∞–µ—Ç –∑–∞–¥–∞—á–∏:
- –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –±–æ–ª—å—à–∏—Ö –¥–∏–∞–ø–∞–∑–æ–Ω–æ–≤ –ª–µ–¥–∂–µ—Ä–æ–≤
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –∏ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã—Ö –ª–µ–¥–∂–µ—Ä–æ–≤
- –ü–µ—Ä–µ—Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –æ–¥–Ω–æ–≥–æ –∏–∑ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
- –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –º–µ–∂–¥—É –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ XRPL —Å–µ—Ä–≤–µ—Ä–∞–º–∏

#### –û—Å–Ω–æ–≤–Ω–æ–π –∞–ª–≥–æ—Ä–∏—Ç–º —Ä–∞–±–æ—Ç—ã

```
1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
   ‚îú‚îÄ‚îÄ –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
   ‚îú‚îÄ‚îÄ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ ClickHouse (–¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞)
   ‚îú‚îÄ‚îÄ –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è platform-cli –±–∏–Ω–∞—Ä–Ω–∏–∫–∞
   ‚îî‚îÄ‚îÄ –°–æ–∑–¥–∞–Ω–∏–µ ProgressTracker –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞

2. –ì–ª–∞–≤–Ω—ã–π —Ü–∏–∫–ª –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏–∏
   –î–ª—è –∫–∞–∂–¥–æ–π –∏—Ç–µ—Ä–∞—Ü–∏–∏:
   ‚îú‚îÄ‚îÄ –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ª–æ–≤–∏–π –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
   ‚îÇ   ‚îú‚îÄ‚îÄ currentFrom > currentTo ‚Üí –≤—ã—Ö–æ–¥
   ‚îÇ   ‚îî‚îÄ‚îÄ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∞–π–ª–∞ stop.orchestrator
   ‚îÇ
   ‚îú‚îÄ‚îÄ –ó–∞–ø—É—Å–∫ –≤–æ—Ä–∫–µ—Ä–æ–≤ (–µ—Å–ª–∏ –Ω–µ –∑–∞–ø—É—â–µ–Ω—ã)
   ‚îÇ   ‚îú‚îÄ‚îÄ FindGaps() - –ø–æ–∏—Å–∫ –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã—Ö –ª–µ–¥–∂–µ—Ä–æ–≤ –≤ ClickHouse
   ‚îÇ   ‚îú‚îÄ‚îÄ –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ø—Ä–æ–ø—É—Å–∫–æ–≤ –º–µ–∂–¥—É N –≤–æ—Ä–∫–µ—Ä–∞–º–∏
   ‚îÇ   ‚îú‚îÄ‚îÄ –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–µ—Ä–æ–≤ (round-robin)
   ‚îÇ   ‚îî‚îÄ‚îÄ –ó–∞–ø—É—Å–∫ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ platform-cli backfill
   ‚îÇ
   ‚îú‚îÄ‚îÄ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤–æ—Ä–∫–µ—Ä–æ–≤ (–∫–∞–∂–¥—ã–µ check-interval)
   ‚îÇ   ‚îú‚îÄ‚îÄ CheckStatus() - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –∫–∞–∂–¥–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞
   ‚îÇ   ‚îî‚îÄ‚îÄ –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–∏–≤—à–∏—Ö—Å—è –≤–æ—Ä–∫–µ—Ä–æ–≤
   ‚îÇ
   ‚îî‚îÄ‚îÄ –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤–æ—Ä–∫–µ—Ä–∞
       ‚îú‚îÄ‚îÄ –†–µ—à–µ–Ω–∏–µ: –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å–µ—Ö –∏–ª–∏ –¥–∞—Ç—å –∑–∞–≤–µ—Ä—à–∏—Ç—å—Å—è?
       ‚îÇ   ‚îî‚îÄ‚îÄ –ï—Å–ª–∏ —É –¥—Ä—É–≥–∏—Ö < redistribute-threshold –ª–µ–¥–∂–µ—Ä–æ–≤ ‚Üí –¥–∞—Ç—å –∑–∞–≤–µ—Ä—à–∏—Ç—å—Å—è
       ‚îÇ   ‚îî‚îÄ‚îÄ –ò–Ω–∞—á–µ ‚Üí –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å–µ—Ö
       ‚îÇ
       ‚îú‚îÄ‚îÄ –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—Å–µ—Ö –≤–æ—Ä–∫–µ—Ä–æ–≤ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
       ‚îÇ
       ‚îú‚îÄ‚îÄ –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–æ–ø—É—Å–∫–æ–≤ (–æ–¥–∏–Ω —Ä–∞–∑ –∑–∞ —Ü–∏–∫–ª)
       ‚îÇ   ‚îú‚îÄ‚îÄ FindGaps() - –ø–æ–∏—Å–∫ –ø—Ä–æ–ø—É—Å–∫–æ–≤ –≤ –ø–æ–ª–Ω–æ–º –¥–∏–∞–ø–∞–∑–æ–Ω–µ
       ‚îÇ   ‚îú‚îÄ‚îÄ –ó–∞–ø—É—Å–∫ N –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è
       ‚îÇ   ‚îî‚îÄ‚îÄ –¢–∞–π–º–∞—É—Ç 10 –º–∏–Ω—É—Ç –Ω–∞ –∫–∞–∂–¥—ã–π –¥–∏–∞–ø–∞–∑–æ–Ω –ø—Ä–æ–ø—É—Å–∫–æ–≤
       ‚îÇ
       ‚îú‚îÄ‚îÄ –ü–µ—Ä–µ—Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã
       ‚îÇ   ‚îú‚îÄ‚îÄ GetRemainingRange() - –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ –æ—Å—Ç–∞–≤—à–µ–≥–æ—Å—è –¥–∏–∞–ø–∞–∑–æ–Ω–∞
       ‚îÇ   ‚îî‚îÄ‚îÄ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ currentFrom/currentTo
       ‚îÇ
       ‚îî‚îÄ‚îÄ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –≤–æ—Ä–∫–µ—Ä–æ–≤ —Å –Ω–æ–≤—ã–º–∏ –¥–∏–∞–ø–∞–∑–æ–Ω–∞–º–∏
```

#### –ö–ª—é—á–µ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

**1. ProgressTracker - –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞**

–û—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä –∏—Å–ø–æ–ª—å–∑—É–µ—Ç ClickHouse –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ç–æ–≥–æ, –∫–∞–∫–∏–µ –ª–µ–¥–∂–µ—Ä—ã —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã:

```go
// cmd/orchestrator/progress.go
ProgressTracker.FindGaps()
  ‚îú‚îÄ‚îÄ –ó–∞–ø—Ä–æ—Å –∫ xrpl.money_flow: SELECT DISTINCT ledger_index WHERE ...
  ‚îú‚îÄ‚îÄ –ó–∞–ø—Ä–æ—Å –∫ xrpl.empty_ledgers: SELECT DISTINCT ledger_index WHERE ...
  ‚îî‚îÄ‚îÄ –í—ã—á–∏—Å–ª–µ–Ω–∏–µ –ø—Ä–æ–ø—É—Å–∫–æ–≤: –≤—Å–µ –ª–µ–¥–∂–µ—Ä—ã –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ, –∫–æ—Ç–æ—Ä—ã—Ö –Ω–µ—Ç –≤ –æ–±–æ–∏—Ö —Ç–∞–±–ª–∏—Ü–∞—Ö
```

–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:
- –£—á–∏—Ç—ã–≤–∞–µ—Ç –∫–∞–∫ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ –ª–µ–¥–∂–µ—Ä—ã (—Å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏), —Ç–∞–∫ –∏ –ø—É—Å—Ç—ã–µ –ª–µ–¥–∂–µ—Ä—ã
- –ò—Å–∫–ª—é—á–∞–µ—Ç –ø—É—Å—Ç—ã–µ –ª–µ–¥–∂–µ—Ä—ã –∏–∑ —Å–ø–∏—Å–∫–∞ –ø—Ä–æ–ø—É—Å–∫–æ–≤ (–æ–Ω–∏ —É–∂–µ –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã)
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã—Ö –∏–Ω–¥–µ–∫—Å–æ–≤

**2. Worker - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–æ–º –±—ç–∫—Ñ–∏–ª–∏–Ω–≥–∞**

–ö–∞–∂–¥—ã–π –≤–æ—Ä–∫–µ—Ä - —ç—Ç–æ –æ—Ç–¥–µ–ª—å–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å `platform-cli backfill`:

```go
// cmd/orchestrator/worker.go
Worker.Start()
  ‚îú‚îÄ‚îÄ –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã: platform-cli backfill --ledgers "N1,N2,..." --server ...
  ‚îú‚îÄ‚îÄ –°–æ–∑–¥–∞–Ω–∏–µ –ª–æ–≥-—Ñ–∞–π–ª–∞: logs/orchestrator-worker-{ID}.log
  ‚îú‚îÄ‚îÄ –ó–∞–ø—É—Å–∫ –ø—Ä–æ—Ü–µ—Å—Å–∞ —á–µ—Ä–µ–∑ exec.Command
  ‚îî‚îÄ‚îÄ –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ PID –∏ —Å—Ç–∞—Ç—É—Å–∞

Worker.CheckStatus()
  ‚îú‚îÄ‚îÄ –ü—Ä–æ–≤–µ—Ä–∫–∞ ProcessState (–µ—Å–ª–∏ –ø—Ä–æ—Ü–µ—Å—Å –∑–∞–≤–µ—Ä—à–∏–ª—Å—è)
  ‚îú‚îÄ‚îÄ –ü—Ä–æ–≤–µ—Ä–∫–∞ /proc/PID/stat (–¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è zombie –ø—Ä–æ—Ü–µ—Å—Å–æ–≤)
  ‚îú‚îÄ‚îÄ Signal(0) - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –ø—Ä–æ—Ü–µ—Å—Å–∞
  ‚îî‚îÄ‚îÄ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞: running/completed/failed
```

–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:
- –ö–∞–∂–¥—ã–π –≤–æ—Ä–∫–µ—Ä –ø–∏—à–µ—Ç –ª–æ–≥–∏ –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ñ–∞–π–ª
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ graceful shutdown (SIGTERM) –∏ force kill
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø—Ä–æ—Ü–µ—Å—Å–∞

**3. –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã**

–û—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —É–º–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ:

- **–ü–æ –ø—Ä–æ–ø—É—Å–∫–∞–º, –∞ –Ω–µ –ø–æ –¥–∏–∞–ø–∞–∑–æ–Ω–∞–º**: –í–æ—Ä–∫–µ—Ä—ã –ø–æ–ª—É—á–∞—é—Ç —Å–ø–∏—Å–∫–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã—Ö –ª–µ–¥–∂–µ—Ä–æ–≤, –∞ –Ω–µ –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω—ã–µ –¥–∏–∞–ø–∞–∑–æ–Ω—ã
- **Round-robin —Å–µ—Ä–≤–µ—Ä–æ–≤**: –í–æ—Ä–∫–µ—Ä—ã —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è –ø–æ XRPL —Å–µ—Ä–≤–µ—Ä–∞–º —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏
- **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è –±–æ–ª—å—à–∏—Ö —Å–ø–∏—Å–∫–æ–≤**: –ï—Å–ª–∏ –ø—Ä–æ–ø—É—Å–∫–æ–≤ >1000, —Å–ø–∏—Å–æ–∫ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ —Ñ–∞–π–ª

**4. –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–æ–ø—É—Å–∫–æ–≤**

–û—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø–æ–ª–Ω—è–µ—Ç –ø—Ä–æ–ø—É—Å–∫–∏ –æ–¥–∏–Ω —Ä–∞–∑ –∑–∞ —Ü–∏–∫–ª:

```go
// cmd/orchestrator/orchestrator.go
fillGaps()
  ‚îú‚îÄ‚îÄ FindGaps() - –ø–æ–∏—Å–∫ –≤—Å–µ—Ö –ø—Ä–æ–ø—É—Å–∫–æ–≤ –≤ –ø–æ–ª–Ω–æ–º –¥–∏–∞–ø–∞–∑–æ–Ω–µ
  ‚îú‚îÄ‚îÄ –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ø—Ä–æ–ø—É—Å–∫–æ–≤ –º–µ–∂–¥—É N –≤–æ—Ä–∫–µ—Ä–∞–º–∏
  ‚îú‚îÄ‚îÄ –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è
  ‚îú‚îÄ‚îÄ –¢–∞–π–º–∞—É—Ç 10 –º–∏–Ω—É—Ç –Ω–∞ –∫–∞–∂–¥—ã–π –¥–∏–∞–ø–∞–∑–æ–Ω
  ‚îî‚îÄ‚îÄ –ù–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç —Ä–∞–±–æ—Ç—É –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö (–Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –ª–µ–¥–∂–µ—Ä—ã –º–æ–≥—É—Ç –±—ã—Ç—å –Ω–∞–º–µ—Ä–µ–Ω–Ω–æ –ø—Ä–æ–ø—É—â–µ–Ω—ã)
```

–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:
- –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑ –∑–∞ —Ü–∏–∫–ª –ø–µ—Ä–µ—Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø—Ä–æ–ø—É—Å–∫–∏ –≤ –ø–æ–ª–Ω–æ–º –∏—Å—Ö–æ–¥–Ω–æ–º –¥–∏–∞–ø–∞–∑–æ–Ω–µ (–Ω–µ —Ç–æ–ª—å–∫–æ –≤ —Ç–µ–∫—É—â–µ–º)
- –ù–µ –∂–¥–µ—Ç —É—Å–ø–µ—à–Ω–æ–≥–æ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –≤—Å–µ—Ö –ø—Ä–æ–ø—É—Å–∫–æ–≤ (–Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º–∏ –ª–µ–¥–∂–µ—Ä–∞–º–∏)

**5. –ü–µ—Ä–µ—Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã**

–ü–æ—Å–ª–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –ø—Ä–æ–ø—É—Å–∫–æ–≤ –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç –æ—Å—Ç–∞–≤—à—É—é—Å—è —Ä–∞–±–æ—Ç—É:

```go
// cmd/orchestrator/progress.go
GetRemainingRange()
  ‚îú‚îÄ‚îÄ FindGaps() - –ø–æ–∏—Å–∫ –æ—Å—Ç–∞–≤—à–∏—Ö—Å—è –ø—Ä–æ–ø—É—Å–∫–æ–≤
  ‚îú‚îÄ‚îÄ –ï—Å–ª–∏ –ø—Ä–æ–ø—É—Å–∫–æ–≤ –Ω–µ—Ç ‚Üí –ø–æ–∏—Å–∫ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω–æ–≥–æ –ª–µ–¥–∂–µ—Ä–∞
  ‚îî‚îÄ‚îÄ –í–æ–∑–≤—Ä–∞—Ç –¥–∏–∞–ø–∞–∑–æ–Ω–∞ –æ—Ç –ø–µ—Ä–≤–æ–≥–æ –ø—Ä–æ–ø—É—Å–∫–∞ –¥–æ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ
```

**6. –£–º–Ω–∞—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤–æ—Ä–∫–µ—Ä–æ–≤**

–û—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä –º–æ–∂–µ—Ç –ª–∏–±–æ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å–µ—Ö –≤–æ—Ä–∫–µ—Ä–æ–≤ —Å—Ä–∞–∑—É, –ª–∏–±–æ –¥–∞—Ç—å –∏–º –∑–∞–≤–µ—Ä—à–∏—Ç—å—Å—è:

- **–ï—Å–ª–∏ —É –¥—Ä—É–≥–∏—Ö –≤–æ—Ä–∫–µ—Ä–æ–≤ < redistribute-threshold –ª–µ–¥–∂–µ—Ä–æ–≤**: –î–∞—Ç—å –∏–º –∑–∞–≤–µ—Ä—à–∏—Ç—å—Å—è, –∑–∞—Ç–µ–º –ø–µ—Ä–µ—Ä–∞—Å–ø—Ä–µ–¥–µ–ª–∏—Ç—å
- **–ò–Ω–∞—á–µ**: –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å–µ—Ö —Å—Ä–∞–∑—É –∏ –ø–µ—Ä–µ—Ä–∞—Å–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ä–∞–±–æ—Ç—É

–≠—Ç–æ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –Ω–µ–Ω—É–∂–Ω—ã–µ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –≤–æ—Ä–∫–µ—Ä–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ—á—Ç–∏ –∑–∞–∫–æ–Ω—á–∏–ª–∏ —Å–≤–æ—é —Ä–∞–±–æ—Ç—É.

#### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏

```bash
platform-orchestrator \
  --workers 4 \                    # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
  --from 82000000 \                # –ù–∞—á–∞–ª—å–Ω—ã–π –∏–Ω–¥–µ–∫—Å –ª–µ–¥–∂–µ—Ä–∞
  --to 85000000 \                  # –ö–æ–Ω–µ—á–Ω—ã–π –∏–Ω–¥–µ–∫—Å –ª–µ–¥–∂–µ—Ä–∞
  --servers "wss://s1.ripple.com/,wss://s2.ripple.com/" \  # XRPL —Å–µ—Ä–≤–µ—Ä—ã
  --check-interval 30s \           # –ò–Ω—Ç–µ—Ä–≤–∞–ª –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç–∞—Ç—É—Å–∞
  --config .env \                  # –§–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
  --cli-path ./bin/platform-cli \  # –ü—É—Ç—å –∫ platform-cli
  --delay 100 \                    # –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏ (–º—Å)
  --redistribute-threshold 5000 \  # –ü–æ—Ä–æ–≥ –¥–ª—è —É–º–Ω–æ–π –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –≤–æ—Ä–∫–µ—Ä–æ–≤
  --verbose                        # –ü–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
```

#### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

- `BACKFILL_MIN_DELAY_MS_WORKER_{N}` - –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è –≤–æ—Ä–∫–µ—Ä–∞ N (–Ω–∞–ø—Ä–∏–º–µ—Ä, `BACKFILL_MIN_DELAY_MS_WORKER_1=200`)

#### –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

1. **–†–∞–±–æ—Ç–∞ —Å –ø—Ä–æ–ø—É—Å–∫–∞–º–∏, –∞ –Ω–µ –¥–∏–∞–ø–∞–∑–æ–Ω–∞–º–∏**: –û—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä –Ω–µ –¥–µ–ª–∏—Ç –¥–∏–∞–ø–∞–∑–æ–Ω –Ω–∞ —Ä–∞–≤–Ω—ã–µ —á–∞—Å—Ç–∏. –í–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ –æ–Ω –Ω–∞—Ö–æ–¥–∏—Ç –≤—Å–µ –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã–µ –ª–µ–¥–∂–µ—Ä—ã –∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∏—Ö –º–µ–∂–¥—É –≤–æ—Ä–∫–µ—Ä–∞–º–∏. –≠—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –≤–æ—Ä–∫–µ—Ä—ã –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç —Ç–æ–ª—å–∫–æ —Ä–µ–∞–ª—å–Ω–æ –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã–µ –ª–µ–¥–∂–µ—Ä—ã.

2. **–û–¥–∏–Ω —Ü–∏–∫–ª –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –ø—Ä–æ–ø—É—Å–∫–æ–≤**: –ü—Ä–æ–ø—É—Å–∫–∏ –∑–∞–ø–æ–ª–Ω—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑ –∑–∞ —Ü–∏–∫–ª –ø–µ—Ä–µ—Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è, —á—Ç–æ–±—ã –Ω–µ —Ç—Ä–∞—Ç–∏—Ç—å –≤—Ä–µ–º—è –Ω–∞ –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏.

3. **Graceful shutdown**: –û—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç graceful shutdown —á–µ—Ä–µ–∑:
   - –°–∏–≥–Ω–∞–ª—ã –û–° (SIGTERM, SIGINT)
   - –§–∞–π–ª `stop.orchestrator` (—Å–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª –¥–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏)

4. **–£—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å –∫ –æ—à–∏–±–∫–∞–º**: –û—à–∏–±–∫–∏ –ø—Ä–∏ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–∏ –ø—Ä–æ–ø—É—Å–∫–æ–≤ –Ω–µ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä. –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –ª–µ–¥–∂–µ—Ä—ã –º–æ–≥—É—Ç –±—ã—Ç—å –Ω–∞–º–µ—Ä–µ–Ω–Ω–æ –ø—Ä–æ–ø—É—â–µ–Ω—ã (–ø—É—Å—Ç—ã–µ –ª–µ–¥–∂–µ—Ä—ã).

5. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —á–µ—Ä–µ–∑ ClickHouse**: –û—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä –∏—Å–ø–æ–ª—å–∑—É–µ—Ç ClickHouse –∫–∞–∫ –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã –æ –ø—Ä–æ–≥—Ä–µ—Å—Å–µ, —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –µ–º—É –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å –¥–∞–∂–µ –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞.

6. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**: –ö–∞–∂–¥—ã–π –≤–æ—Ä–∫–µ—Ä –ø–∏—à–µ—Ç –ª–æ–≥–∏ –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ñ–∞–π–ª (`logs/orchestrator-worker-{ID}.log`), —á—Ç–æ —É–ø—Ä–æ—â–∞–µ—Ç –æ—Ç–ª–∞–¥–∫—É.

#### –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

**–ë–∞–∑–æ–≤—ã–π –∑–∞–ø—É—Å–∫ —Å 2 –≤–æ—Ä–∫–µ—Ä–∞–º–∏:**
```bash
./bin/platform-orchestrator --workers 2 --from 82000000 --to 82010000
```

**–ó–∞–ø—É—Å–∫ —Å 4 –≤–æ—Ä–∫–µ—Ä–∞–º–∏ –∏ 3 —Å–µ—Ä–≤–µ—Ä–∞–º–∏:**
```bash
./bin/platform-orchestrator \
  --workers 4 \
  --from 82000000 \
  --to 85000000 \
  --servers "wss://s1.ripple.com/,wss://s2.ripple.com/,wss://xrplcluster.com/"
```

**–ó–∞–ø—É—Å–∫ —Å —É–º–Ω–æ–π –æ—Å—Ç–∞–Ω–æ–≤–∫–æ–π (–¥–∞—Ç—å –≤–æ—Ä–∫–µ—Ä–∞–º –∑–∞–≤–µ—Ä—à–∏—Ç—å—Å—è, –µ—Å–ª–∏ –æ—Å—Ç–∞–ª–æ—Å—å <1000 –ª–µ–¥–∂–µ—Ä–æ–≤):**
```bash
./bin/platform-orchestrator \
  --workers 3 \
  --from 82000000 \
  --to 83000000 \
  --redistribute-threshold 1000
```

**–û—Å—Ç–∞–Ω–æ–≤–∫–∞ –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä–∞:**
```bash
# –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª stop.orchestrator
touch stop.orchestrator
# –û—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –≤ —Ç–µ—á–µ–Ω–∏–µ 5 —Å–µ–∫—É–Ω–¥
```

#### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–û—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä –ª–æ–≥–∏—Ä—É–µ—Ç:
- –ó–∞–ø—É—Å–∫ –∏ –æ—Å—Ç–∞–Ω–æ–≤–∫—É –≤–æ—Ä–∫–µ—Ä–æ–≤
- –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –ø—Ä–æ–ø—É—Å–∫–æ–≤
- –ü—Ä–æ–≥—Ä–µ—Å—Å –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –ø—Ä–æ–ø—É—Å–∫–æ–≤
- –ü–µ—Ä–µ—Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ –∑–∞–≤–µ—Ä—à–∏–≤—à–∏–º—Å—è –≤–æ—Ä–∫–µ—Ä–∞–º

–ö–∞–∂–¥—ã–π –≤–æ—Ä–∫–µ—Ä –ø–∏—à–µ—Ç —Å–≤–æ–∏ –ª–æ–≥–∏ –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ñ–∞–π–ª:
- `logs/orchestrator-worker-1.log`
- `logs/orchestrator-worker-2.log`
- –∏ —Ç.–¥.

–ü—Ä–∏–º–µ—Ä –ª–æ–≥–∞ –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä–∞:
```
[ORCHESTRATOR] Starting orchestrator with 4 workers
[ORCHESTRATOR] Target range: 82000000-85000000
[ORCHESTRATOR] Found 1250 gaps to process
[ORCHESTRATOR] Started worker 1: 313 gaps (range 82000001-82000313) on server wss://s1.ripple.com/
[ORCHESTRATOR] Started worker 2: 313 gaps (range 82000314-82000626) on server wss://s2.ripple.com/
[ORCHESTRATOR] Worker 1 completed
[ORCHESTRATOR] Stopping all workers before redistribution...
[ORCHESTRATOR] Attempting to fill gaps in full range 82000000-85000000
[ORCHESTRATOR] Gap filling phase completed: 3 succeeded, 1 failed
[ORCHESTRATOR] Remaining range: 82010000-85000000
[ORCHESTRATOR] Successfully restarted 4 workers with new ranges
```

#### –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å –ø—Ä–æ—Ü–µ—Å—Å–æ–º –±—ç–∫—Ñ–∏–ª–∏–Ω–≥–∞

–û—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä –∑–∞–ø—É—Å–∫–∞–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å—ã `platform-cli backfill` —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏:
- `--ledgers "N1,N2,N3"` –∏–ª–∏ `--ledgers-file path.txt` - —Å–ø–∏—Å–æ–∫ –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã—Ö –ª–µ–¥–∂–µ—Ä–æ–≤
- `--server <URL>` - –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–π XRPL —Å–µ—Ä–≤–µ—Ä
- `--delay <ms>` - –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞
- `--config .env` - —Ñ–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- `--verbose` - –µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω verbose —Ä–µ–∂–∏–º –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä–∞

–ü—Ä–æ—Ü–µ—Å—Å—ã —Ä–∞–±–æ—Ç–∞—é—Ç –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –∏ –ø–∏—à—É—Ç –¥–∞–Ω–Ω—ã–µ –Ω–∞–ø—Ä—è–º—É—é –≤ ClickHouse. –û—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä —Ç–æ–ª—å–∫–æ –∫–æ–æ—Ä–¥–∏–Ω–∏—Ä—É–µ—Ç –∏—Ö —Ä–∞–±–æ—Ç—É.

---

### 3. –ü—Ä–æ—Ü–µ—Å—Å –∏–Ω–¥–µ–∫—Å–µ—Ä–∞ (`platform-server`)

**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `main.go`, `producers/`  
**–ë–∏–Ω–∞—Ä–Ω–∏–∫:** `bin/platform-server.exe` (Windows) / `bin/platform-server` (Linux)  
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è XRPL –ª–µ–¥–∂–µ—Ä–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ —á–µ—Ä–µ–∑ WebSocket –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ

#### –û–±–∑–æ—Ä —Ä–∞–±–æ—Ç—ã

–ü—Ä–æ—Ü–µ—Å—Å –∏–Ω–¥–µ–∫—Å–µ—Ä–∞ - —ç—Ç–æ –æ—Å–Ω–æ–≤–Ω–æ–π —Å–µ—Ä–≤–∏—Å, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ XRPL –Ω–æ–¥–µ —á–µ—Ä–µ–∑ WebSocket –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ª–µ–¥–∂–µ—Ä—ã –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ –ø–æ –º–µ—Ä–µ –∏—Ö –∑–∞–∫—Ä—ã—Ç–∏—è. –û–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –¥–≤—É—Ö —Ä–µ–∂–∏–º–∞—Ö:

1. **Server mode** (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é): –ü–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–∏—Å —Å HTTP API –∏ Socket.IO
2. **Indexer mode** (subprocess): –£–ø—Ä–æ—â–µ–Ω–Ω—ã–π —Ä–µ–∂–∏–º –¥–ª—è —Ä–∞–±–æ—Ç—ã –ø–æ–¥ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä–∞

#### –û—Å–Ω–æ–≤–Ω–æ–π –∞–ª–≥–æ—Ä–∏—Ç–º —Ä–∞–±–æ—Ç—ã

```
1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
   ‚îú‚îÄ‚îÄ –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∏–∑ .env
   ‚îú‚îÄ‚îÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ª–æ–≥–≥–µ—Ä–∞
   ‚îú‚îÄ‚îÄ –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–µ–∂–∏–º–∞ —Ä–∞–±–æ—Ç—ã (--mode server/indexer)
   ‚îÇ
   ‚îî‚îÄ‚îÄ –í–µ—Ç–≤–ª–µ–Ω–∏–µ –ø–æ —Ä–µ–∂–∏–º—É:
       ‚îú‚îÄ‚îÄ Server mode:
       ‚îÇ   ‚îú‚îÄ‚îÄ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ ClickHouse
       ‚îÇ   ‚îú‚îÄ‚îÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Socket.IO hub
       ‚îÇ   ‚îú‚îÄ‚îÄ –ó–∞–ø—É—Å–∫ HTTP —Å–µ—Ä–≤–µ—Ä–∞ (Echo)
       ‚îÇ   ‚îî‚îÄ‚îÄ –ó–∞–ø—É—Å–∫ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
       ‚îÇ
       ‚îî‚îÄ‚îÄ Indexer mode:
           ‚îú‚îÄ‚îÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è IPC –ø—Ä–æ—Ç–æ–∫–æ–ª–∞ (stdout/stdin)
           ‚îú‚îÄ‚îÄ –û—Ç–ø—Ä–∞–≤–∫–∞ ready event –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä—É
           ‚îî‚îÄ‚îÄ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ XRPL (–±–µ–∑ ClickHouse - –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä —É–ø—Ä–∞–≤–ª—è–µ—Ç)

2. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ XRPL
   ‚îú‚îÄ‚îÄ connections.NewXrplClient() - WebSocket –∫–ª–∏–µ–Ω—Ç
   ‚îú‚îÄ‚îÄ connections.NewXrplRPCClient() - RPC –∫–ª–∏–µ–Ω—Ç
   ‚îú‚îÄ‚îÄ connections.SubscribeStreams() - –ø–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –ø–æ—Ç–æ–∫–∏
   ‚îÇ   ‚îî‚îÄ‚îÄ –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞: ledger, validations
   ‚îî‚îÄ‚îÄ connections.MonitorXRPLConnection() - –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è

3. –ì–ª–∞–≤–Ω—ã–π —Ü–∏–∫–ª –æ–±—Ä–∞–±–æ—Ç–∫–∏ (producers.RunProducers())
   –î–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–æ–±—ã—Ç–∏—è –∏–∑ XRPL:
   ‚îú‚îÄ‚îÄ StreamLedger (–∑–∞–∫—Ä—ã—Ç–∏–µ –ª–µ–¥–∂–µ—Ä–∞)
   ‚îÇ   ‚îú‚îÄ‚îÄ –ü–∞—Ä—Å–∏–Ω–≥ LedgerStream —Å–æ–æ–±—â–µ–Ω–∏—è
   ‚îÇ   ‚îú‚îÄ‚îÄ –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –ø—Ä–æ–ø—É—Å–∫–æ–≤ (–µ—Å–ª–∏ ledger_index > prev+1)
   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ backfillMissingRange() - –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–æ–ø—É—Å–∫–æ–≤
   ‚îÇ   ‚îî‚îÄ‚îÄ ProcessTransactionsDirectly(ledger, isRealtime=true)
   ‚îÇ       ‚îú‚îÄ‚îÄ FetchTransactions() - –ø–æ–ª—É—á–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π —á–µ—Ä–µ–∑ RPC
   ‚îÇ       ‚îú‚îÄ‚îÄ –î–ª—è –∫–∞–∂–¥–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏:
   ‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö (ledger_index, date, validated)
   ‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–µ–∂–∏–º–∞:
   ‚îÇ       ‚îÇ       ‚îú‚îÄ‚îÄ Indexer mode: –æ—Ç–ø—Ä–∞–≤–∫–∞ —á–µ—Ä–µ–∑ IPC
   ‚îÇ       ‚îÇ       ‚îî‚îÄ‚îÄ Server mode: ProcessTransaction() + Socket.IO
   ‚îÇ       ‚îî‚îÄ‚îÄ –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–æ–≤—ã—Ö —Ç–æ–∫–µ–Ω–æ–≤ (—Ç–æ–ª—å–∫–æ –≤ server mode)
   ‚îÇ
   ‚îî‚îÄ‚îÄ –î—Ä—É–≥–∏–µ –ø–æ—Ç–æ–∫–∏ (validation, peer_status, consensus, etc.) - –∏–≥–Ω–æ—Ä–∏—Ä—É—é—Ç—Å—è

4. –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
   ‚îú‚îÄ‚îÄ consumers.ProcessTransaction()
   ‚îÇ   ‚îú‚îÄ‚îÄ –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è: —Ç–æ–ª—å–∫–æ Payment —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —Å tesSUCCESS
   ‚îÇ   ‚îú‚îÄ‚îÄ ExtractBalanceChanges() - –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –±–∞–ª–∞–Ω—Å–æ–≤
   ‚îÇ   ‚îú‚îÄ‚îÄ BuildActionGroups() - –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –≤ –¥–µ–π—Å—Ç–≤–∏—è
   ‚îÇ   ‚îî‚îÄ‚îÄ –ó–∞–ø–∏—Å—å money_flow —Å—Ç—Ä–æ–∫ –≤ ClickHouse
   ‚îÇ
   ‚îî‚îÄ‚îÄ Socket.IO —Å–æ–±—ã—Ç–∏—è (—Ç–æ–ª—å–∫–æ –≤ server mode, —Ç–æ–ª—å–∫–æ –¥–ª—è isRealtime=true)
       ‚îú‚îÄ‚îÄ –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–±—ã—Ç–∏–π –æ –Ω–æ–≤—ã—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è—Ö
       ‚îî‚îÄ‚îÄ –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–±—ã—Ç–∏–π –æ –Ω–æ–≤—ã—Ö —Ç–æ–∫–µ–Ω–∞—Ö
```

#### –ö–ª—é—á–µ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

**1. WebSocket –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ XRPL**

–ü—Ä–æ—Ü–µ—Å—Å –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ XRPL –Ω–æ–¥–µ —á–µ—Ä–µ–∑ WebSocket –∏ –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –Ω–∞ –ø–æ—Ç–æ–∫–∏:

```go
// connections/stream.go
SubscribeStreams()
  ‚îî‚îÄ‚îÄ XrplClient.Subscribe([StreamTypeLedger, StreamTypeValidations])
      ‚îî‚îÄ‚îÄ –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –ø–æ—Ç–æ–∫ –∑–∞–∫—Ä—ã—Ç–∏—è –ª–µ–¥–∂–µ—Ä–æ–≤
```

–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Å —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–º backoff
- –ü–æ–¥–ø–∏—Å–∫–∞ —Ç–æ–ª—å–∫–æ –Ω–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–æ—Ç–æ–∫–∏ (ledger, validations)
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è

**2. –û–±—Ä–∞–±–æ—Ç–∫–∞ –ª–µ–¥–∂–µ—Ä–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏**

–ö–æ–≥–¥–∞ XRPL –Ω–æ–¥–∞ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç –Ω–æ–≤—ã–π –ª–µ–¥–∂–µ—Ä, –ø—Ä–æ—Ü–µ—Å—Å –ø–æ–ª—É—á–∞–µ—Ç —Å–æ–±—ã—Ç–∏–µ:

```go
// producers/main.go
RunProducers()
  ‚îî‚îÄ‚îÄ case ledger := <-connections.XrplClient.StreamLedger:
      ‚îú‚îÄ‚îÄ –ü–∞—Ä—Å–∏–Ω–≥ LedgerStream
      ‚îú‚îÄ‚îÄ –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –ø—Ä–æ–ø—É—Å–∫–æ–≤ (–µ—Å–ª–∏ –±—ã–ª–∏ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è)
      ‚îî‚îÄ‚îÄ –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞: go ProcessTransactionsDirectly(ledger, true)
```

**3. –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –∏ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–æ–ø—É—Å–∫–æ–≤**

–ï—Å–ª–∏ –ø—Ä–æ—Ü–µ—Å—Å –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–∏–ª—Å—è –∏ –ø—Ä–æ–ø—É—Å—Ç–∏–ª –ª–µ–¥–∂–µ—Ä—ã, –æ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Ö –∑–∞–ø–æ–ª–Ω—è–µ—Ç:

```go
// producers/main.go
backfillMissingRange(from, to)
  ‚îî‚îÄ‚îÄ –î–ª—è –∫–∞–∂–¥–æ–≥–æ –ø—Ä–æ–ø—É—â–µ–Ω–Ω–æ–≥–æ –ª–µ–¥–∂–µ—Ä–∞:
      ‚îî‚îÄ‚îÄ ProcessTransactionsDirectly(ledger, isRealtime=false)
          ‚îî‚îÄ‚îÄ –ù–ï –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç Socket.IO —Å–æ–±—ã—Ç–∏—è (isRealtime=false)
```

**4. –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π**

–î–ª—è –∫–∞–∂–¥–æ–≥–æ –ª–µ–¥–∂–µ—Ä–∞ –ø—Ä–æ—Ü–µ—Å—Å –ø–æ–ª—É—á–∞–µ—Ç –≤—Å–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —á–µ—Ä–µ–∑ RPC:

```go
// producers/transaction.go
ProcessTransactionsDirectly(ledger, isRealtime)
  ‚îî‚îÄ‚îÄ ledger.FetchTransactions()
      ‚îî‚îÄ‚îÄ XRPL RPC –∑–∞–ø—Ä–æ—Å: {"command": "ledger", "ledger_index": N, "transactions": true}
```

**5. –î–≤–∞ —Ä–µ–∂–∏–º–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏**

**Server mode (standalone):**
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –Ω–∞–ø—Ä—è–º—É—é —á–µ—Ä–µ–∑ `consumers.ProcessTransaction()`
- –ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ ClickHouse
- –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç Socket.IO —Å–æ–±—ã—Ç–∏—è –¥–ª—è —Ä–µ–∞–ª—å–Ω—ã—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–æ–≤—ã–µ —Ç–æ–∫–µ–Ω—ã

**Indexer mode (subprocess):**
- –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä—É —á–µ—Ä–µ–∑ IPC (stdout)
- –ù–µ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ ClickHouse (–æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä —É–ø—Ä–∞–≤–ª—è–µ—Ç)
- –ù–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç Socket.IO —Å–æ–±—ã—Ç–∏—è
- –û—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∏ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –≤ ClickHouse

**6. IPC –ø—Ä–æ—Ç–æ–∫–æ–ª (–¥–ª—è indexer mode)**

–í —Ä–µ–∂–∏–º–µ subprocess –ø—Ä–æ—Ü–µ—Å—Å –æ–±—â–∞–µ—Ç—Å—è —Å –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º —á–µ—Ä–µ–∑ IPC:

```go
// producers/ipc.go
SendBatchTransactionsViaIPC(txs)
  ‚îî‚îÄ‚îÄ –û—Ç–ø—Ä–∞–≤–∫–∞ –±–∞—Ç—á–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π —á–µ—Ä–µ–∑ stdout
      ‚îî‚îÄ‚îÄ –§–æ—Ä–º–∞—Ç: JSON —Å–æ–±—ã—Ç–∏—è (EventTypeBatch)
```

**7. Socket.IO —Å–æ–±—ã—Ç–∏—è (—Ç–æ–ª—å–∫–æ –≤ server mode)**

–î–ª—è —Ä–µ–∞–ª—å–Ω—ã—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –ø—Ä–æ—Ü–µ—Å—Å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–±—ã—Ç–∏—è —á–µ—Ä–µ–∑ Socket.IO:

```go
// socketio/hub.go
EmitSubscriptionActivity(event)
  ‚îî‚îÄ‚îÄ –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–±—ã—Ç–∏–π –≤—Å–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã–º –∫–ª–∏–µ–Ω—Ç–∞–º
      ‚îî‚îÄ‚îÄ –§–æ—Ä–º–∞—Ç: Socket.IO Engine.IO v4
```

#### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏

```bash
platform-server \
  --mode server \        # –†–µ–∂–∏–º: 'server' (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) –∏–ª–∏ 'indexer'
  --config .env          # –§–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
```

#### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

- `XRPL_WEBSOCKET_URL` - URL XRPL –Ω–æ–¥—ã –¥–ª—è WebSocket –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
- `INDEXER_MODE` - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –ø—Ä–∏ `--mode indexer`
- `LOG_LEVEL`, `LOG_FILE_PATH` - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
- `CLICKHOUSE_*` - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ ClickHouse (—Ç–æ–ª—å–∫–æ –≤ server mode)

#### –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

1. **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞**: –ö–∞–∂–¥—ã–π –ª–µ–¥–∂–µ—Ä –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–π goroutine, —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –ª–µ–¥–∂–µ—Ä–æ–≤ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ.

2. **–û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –ø—Ä–æ–ø—É—Å–∫–æ–≤**: –ü—Ä–æ—Ü–µ—Å—Å –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –ø–æ—Å–ª–µ–¥–Ω–∏–π –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–π `ledger_index` –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø–æ–ª–Ω—è–µ—Ç –ø—Ä–æ–ø—É—Å–∫–∏ –ø—Ä–∏ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏.

3. **–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ —Ä–µ–∂–∏–º–æ–≤**: Server mode –∏ Indexer mode –∏—Å–ø–æ–ª—å–∑—É—é—Ç –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ –∫–æ–¥, –Ω–æ —Å —Ä–∞–∑–Ω–æ–π –ª–æ–≥–∏–∫–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π.

4. **Socket.IO —Ç–æ–ª—å–∫–æ –¥–ª—è —Ä–µ–∞–ª—å–Ω—ã—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π**: –°–æ–±—ã—Ç–∏—è –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –∏–∑ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ (`isRealtime=true`), –∞ –Ω–µ –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –ø—Ä–æ–ø—É—Å–∫–æ–≤.

5. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è**: –ü—Ä–æ—Ü–µ—Å—Å –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –º–æ–Ω–∏—Ç–æ—Ä–∏—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –ø—Ä–∏ –æ–±—Ä—ã–≤–µ.

6. **Graceful shutdown**: –í server mode –ø—Ä–æ—Ü–µ—Å—Å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–∏–≥–Ω–∞–ª—ã –û–° –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ä–∞–±–æ—Ç—ã.

#### –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

**–ó–∞–ø—É—Å–∫ –≤ server mode (standalone):**
```bash
./bin/platform-server --mode server --config .env
```

**–ó–∞–ø—É—Å–∫ –≤ indexer mode (–¥–ª—è –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä–∞):**
```bash
./bin/platform-server --mode indexer --config .env
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ HTTP API
curl http://localhost:8080/socketio/health

# –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Socket.IO (JavaScript)
const socket = io('http://localhost:8080/socket.io/');
socket.on('subscription_activity', (data) => {
  console.log('New transaction:', data);
});
```

#### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–ü—Ä–æ—Ü–µ—Å—Å –ª–æ–≥–∏—Ä—É–µ—Ç:
- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ XRPL –∏ –ø–æ–¥–ø–∏—Å–∫—É –Ω–∞ –ø–æ—Ç–æ–∫–∏
- –ö–∞–∂–¥—ã–π –∑–∞–∫—Ä—ã—Ç—ã–π –ª–µ–¥–∂–µ—Ä (ledger_index, hash, txn_count)
- –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –∏ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–æ–ø—É—Å–∫–æ–≤
- –û—à–∏–±–∫–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
- Socket.IO —Å–æ–±—ã—Ç–∏—è (–≤ debug —Ä–µ–∂–∏–º–µ)

–ü—Ä–∏–º–µ—Ä –ª–æ–≥–∞:
```
[INFO] Producers started, waiting for ledgers...
[INFO] New ledger closed ledger_index=12345678 ledger_hash=ABC... txn_count=42
[INFO] Backfilling missing ledger range from=12345675 to=12345677 count=3
[INFO] Sent transactions batch via IPC ledger_index=12345678 txs_sent=15
```

#### –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å –¥—Ä—É–≥–∏–º–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏

**–° –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º –∏–Ω–¥–µ–∫—Å–µ—Ä–∞ (indexer mode):**
- –ü—Ä–æ—Ü–µ—Å—Å –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∫–∞–∫ subprocess –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä–∞
- –û–±—â–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ IPC (stdout/stdin)
- –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –±–∞—Ç—á–∞–º–∏
- –ü–æ–ª—É—á–∞–µ—Ç –∫–æ–º–∞–Ω–¥—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ—Ç –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä–∞

**–° ClickHouse (server mode):**
- –ü—Ä—è–º–∞—è –∑–∞–ø–∏—Å—å money_flow —Å—Ç—Ä–æ–∫
- –ë–∞—Ç—á–∏–Ω–≥ –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–æ–≤—ã—Ö —Ç–æ–∫–µ–Ω–æ–≤

**–° –∫–ª–∏–µ–Ω—Ç–∞–º–∏ (server mode):**
- HTTP REST API –¥–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤
- Socket.IO WebSocket –¥–ª—è —Ä–µ–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–æ–¥–ø–∏—Å–æ–∫ –Ω–∞ –∞–¥—Ä–µ—Å–∞ –∏ —Ç–æ–∫–µ–Ω—ã

---

### 4. –û—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä –∏–Ω–¥–µ–∫—Å–µ—Ä–∞ (`indexer-orchestrator`)

**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `cmd/indexer-orchestrator/`  
**–ë–∏–Ω–∞—Ä–Ω–∏–∫:** `bin/indexer-orchestrator.exe` (Windows) / `bin/indexer-orchestrator` (Linux)  
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–º–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ —Å –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–µ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π

#### –û–±–∑–æ—Ä —Ä–∞–±–æ—Ç—ã

–û—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä –∏–Ω–¥–µ–∫—Å–µ—Ä–∞ - —ç—Ç–æ –º–µ–Ω–µ–¥–∂–µ—Ä –ø—Ä–æ—Ü–µ—Å—Å–æ–≤, –∫–æ—Ç–æ—Ä—ã–π –∫–æ–æ—Ä–¥–∏–Ω–∏—Ä—É–µ—Ç —Ä–∞–±–æ—Ç—É –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏ (`platform-server --mode indexer`). –û–Ω —Ä–µ—à–∞–µ—Ç –∑–∞–¥–∞—á–∏:
- –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö XRPL –Ω–æ–¥ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
- –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π (–æ–¥–Ω–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –º–æ–∂–µ—Ç –ø—Ä–∏–π—Ç–∏ –æ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –≤–æ—Ä–∫–µ—Ä–æ–≤)
- –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –∑–∞–ø–∏—Å—å –≤ ClickHouse
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ Socket.IO —Å–æ–±—ã—Ç–∏—è–º–∏
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ —É–ø–∞–≤—à–∏—Ö –≤–æ—Ä–∫–µ—Ä–æ–≤

#### –û—Å–Ω–æ–≤–Ω–æ–π –∞–ª–≥–æ—Ä–∏—Ç–º —Ä–∞–±–æ—Ç—ã

```
1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
   ‚îú‚îÄ‚îÄ –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
   ‚îú‚îÄ‚îÄ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ ClickHouse (—Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ)
   ‚îú‚îÄ‚îÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Socket.IO hub
   ‚îú‚îÄ‚îÄ –ó–∞–ø—É—Å–∫ HTTP —Å–µ—Ä–≤–µ—Ä–∞ –¥–ª—è Socket.IO
   ‚îú‚îÄ‚îÄ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ callback –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–æ–∫–µ–Ω–æ–≤ –ø–æ—Å–ª–µ flush –±–∞—Ç—á–µ–π
   ‚îî‚îÄ‚îÄ –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è platform-server –±–∏–Ω–∞—Ä–Ω–∏–∫–∞

2. –ó–∞–ø—É—Å–∫ –≤–æ—Ä–∫–µ—Ä–æ–≤
   ‚îú‚îÄ‚îÄ –°–æ–∑–¥–∞–Ω–∏–µ N –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ platform-server --mode indexer
   ‚îú‚îÄ‚îÄ –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ XRPL —Å–µ—Ä–≤–µ—Ä–æ–≤ (round-robin)
   ‚îú‚îÄ‚îÄ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ IPC –ø—Ä–æ—Ç–æ–∫–æ–ª–∞ (stdout/stdin –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –≤–æ—Ä–∫–µ—Ä–∞)
   ‚îî‚îÄ‚îÄ –ó–∞–ø—É—Å–∫ goroutine –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ IPC –∫–∞–∂–¥–æ–≥–æ –≤–æ—Ä–∫–µ—Ä–∞

3. –ì–ª–∞–≤–Ω—ã–π —Ü–∏–∫–ª –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏–∏
   –î–ª—è –∫–∞–∂–¥–æ–π –∏—Ç–µ—Ä–∞—Ü–∏–∏:
   ‚îú‚îÄ‚îÄ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –≤—Å–µ—Ö –≤–æ—Ä–∫–µ—Ä–æ–≤
   ‚îÇ   ‚îî‚îÄ‚îÄ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —É–ø–∞–≤—à–∏—Ö –≤–æ—Ä–∫–µ—Ä–æ–≤
   ‚îÇ
   ‚îî‚îÄ‚îÄ –û–±—Ä–∞–±–æ—Ç–∫–∞ IPC —Å–æ–±—ã—Ç–∏–π –æ—Ç –≤–æ—Ä–∫–µ—Ä–æ–≤ (–≤ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö goroutines)
       ‚îú‚îÄ‚îÄ EventTypeReady - –≤–æ—Ä–∫–µ—Ä –≥–æ—Ç–æ–≤
       ‚îú‚îÄ‚îÄ EventTypeBatch - –±–∞—Ç—á —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
       ‚îú‚îÄ‚îÄ EventTypeData - –æ–¥–Ω–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è
       ‚îú‚îÄ‚îÄ EventTypeError - –æ—à–∏–±–∫–∞ –æ—Ç –≤–æ—Ä–∫–µ—Ä–∞
       ‚îî‚îÄ‚îÄ EventTypeDone - –≤–æ—Ä–∫–µ—Ä –∑–∞–≤–µ—Ä—à–∏–ª—Å—è

4. –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
   –î–ª—è –∫–∞–∂–¥–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –æ—Ç –≤–æ—Ä–∫–µ—Ä–∞:
   ‚îú‚îÄ‚îÄ –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏ (–ø–æ hash)
   ‚îÇ   ‚îî‚îÄ‚îÄ –ï—Å–ª–∏ —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–∞ ‚Üí –ø—Ä–æ–ø—É—Å–∫
   ‚îú‚îÄ‚îÄ Mark as processed (–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ hash –≤ –ø–∞–º—è—Ç—å)
   ‚îú‚îÄ‚îÄ consumers.ProcessTransaction() - –æ–±—Ä–∞–±–æ—Ç–∫–∞
   ‚îú‚îÄ‚îÄ –ó–∞–ø–∏—Å—å –≤ ClickHouse (–±–∞—Ç—á–∏–Ω–≥)
   ‚îî‚îÄ‚îÄ –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ –ª–µ–¥–∂–µ—Ä–∞–º –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–æ–∫–µ–Ω–æ–≤

5. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–æ–≤—ã—Ö —Ç–æ–∫–µ–Ω–æ–≤
   –ü–æ—Å–ª–µ flush –±–∞—Ç—á–∞ –≤ ClickHouse:
   ‚îú‚îÄ‚îÄ –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ money_flows –ø–æ ledger_index
   ‚îú‚îÄ‚îÄ connections.CheckAndNotifyNewTokens() - –ø—Ä–æ–≤–µ—Ä–∫–∞
   ‚îî‚îÄ‚îÄ –û—Ç–ø—Ä–∞–≤–∫–∞ Socket.IO —Å–æ–±—ã—Ç–∏–π –æ –Ω–æ–≤—ã—Ö —Ç–æ–∫–µ–Ω–∞—Ö
```

#### –ö–ª—é—á–µ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

**1. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–æ—Ä–∫–µ—Ä–∞–º–∏**

–û—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä –∑–∞–ø—É—Å–∫–∞–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å—ã `platform-server --mode indexer` –∫–∞–∫ subprocess:

```go
// cmd/indexer-orchestrator/worker.go
NewIndexerWorker(id, serverPath, configFile, serverURL)
  ‚îî‚îÄ‚îÄ –°–æ–∑–¥–∞–Ω–∏–µ subprocess —á–µ—Ä–µ–∑ ipc.NewSubprocessWithDir()
      ‚îú‚îÄ‚îÄ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ XRPL_WEBSOCKET_URL –¥–ª—è –≤–æ—Ä–∫–µ—Ä–∞
      ‚îú‚îÄ‚îÄ –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ stderr –≤ –ª–æ–≥-—Ñ–∞–π–ª
      ‚îî‚îÄ‚îÄ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ IPC —á–µ—Ä–µ–∑ stdout/stdin
```

–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:
- –ö–∞–∂–¥—ã–π –≤–æ—Ä–∫–µ—Ä –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ —Å–≤–æ–µ–º—É XRPL —Å–µ—Ä–≤–µ—Ä—É (round-robin —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ)
- –õ–æ–≥–∏ –∫–∞–∂–¥–æ–≥–æ –≤–æ—Ä–∫–µ—Ä–∞ –ø–∏—à—É—Ç—Å—è –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ñ–∞–π–ª (`logs/indexer-worker-{ID}.log`)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ø—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏ –≤–æ—Ä–∫–µ—Ä–∞

**2. IPC –ø—Ä–æ—Ç–æ–∫–æ–ª**

–û—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä –æ–±—â–∞–µ—Ç—Å—è —Å –≤–æ—Ä–∫–µ—Ä–∞–º–∏ —á–µ—Ä–µ–∑ IPC (stdout/stdin):

```go
// cmd/indexer-orchestrator/orchestrator.go
handleWorkerIPC(worker)
  ‚îî‚îÄ‚îÄ ipc.NewScannerProtocol(worker.Stdin(), worker.Stdout())
      ‚îî‚îÄ‚îÄ –ß—Ç–µ–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π –æ—Ç –≤–æ—Ä–∫–µ—Ä–∞:
          ‚îú‚îÄ‚îÄ EventTypeReady - –≤–æ—Ä–∫–µ—Ä –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ
          ‚îú‚îÄ‚îÄ EventTypeBatch - –±–∞—Ç—á —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π (JSON)
          ‚îú‚îÄ‚îÄ EventTypeData - –æ–¥–Ω–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è (JSON)
          ‚îú‚îÄ‚îÄ EventTypeError - –æ—à–∏–±–∫–∞
          ‚îî‚îÄ‚îÄ EventTypeDone - –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã
```

**3. –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π**

–û—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –≤ –ø–∞–º—è—Ç–∏:

```go
// cmd/indexer-orchestrator/orchestrator.go
processTransaction(data, workerID)
  ‚îú‚îÄ‚îÄ –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ hash —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
  ‚îú‚îÄ‚îÄ –ü—Ä–æ–≤–µ—Ä–∫–∞ processedHashes[hash]
  ‚îÇ   ‚îî‚îÄ‚îÄ –ï—Å–ª–∏ —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–∞ ‚Üí return (–ø—Ä–æ–ø—É—Å–∫)
  ‚îú‚îÄ‚îÄ Mark as processed: processedHashes[hash] = true
  ‚îî‚îÄ‚îÄ –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
```

–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:
- –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –ø–æ hash —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- Thread-safe –¥–æ—Å—Ç—É–ø —á–µ—Ä–µ–∑ sync.RWMutex
- –£–¥–∞–ª–µ–Ω–∏–µ –∏–∑ processedHashes –ø—Ä–∏ –æ—à–∏–±–∫–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ (–¥–ª—è retry)

**4. –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –∑–∞–ø–∏—Å—å –≤ ClickHouse**

–í—Å–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –æ—Ç –≤—Å–µ—Ö –≤–æ—Ä–∫–µ—Ä–æ–≤ –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –≤ –æ–¥–∏–Ω ClickHouse:

```go
// cmd/indexer-orchestrator/orchestrator.go
processTransaction()
  ‚îî‚îÄ‚îÄ consumers.ProcessTransaction(tx)
      ‚îî‚îÄ‚îÄ connections.WriteMoneyFlowRow()
          ‚îî‚îÄ‚îÄ –ó–∞–ø–∏—Å—å –≤ –±–∞—Ç—á (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π flush –ø—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ —Ä–∞–∑–º–µ—Ä–∞)
```

**5. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–æ–≤—ã—Ö —Ç–æ–∫–µ–Ω–æ–≤**

–ü–æ—Å–ª–µ flush –±–∞—Ç—á–∞ –≤ ClickHouse –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–æ–≤—ã–µ —Ç–æ–∫–µ–Ω—ã:

```go
// cmd/indexer-orchestrator/orchestrator.go
onBatchFlush(batch []MoneyFlowRow)
  ‚îú‚îÄ‚îÄ –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ money_flows –ø–æ ledger_index
  ‚îú‚îÄ‚îÄ connections.CheckAndNotifyNewTokens() - –ø—Ä–æ–≤–µ—Ä–∫–∞
  ‚îî‚îÄ‚îÄ –û—Ç–ø—Ä–∞–≤–∫–∞ Socket.IO —Å–æ–±—ã—Ç–∏–π –æ –Ω–æ–≤—ã—Ö —Ç–æ–∫–µ–Ω–∞—Ö
```

**6. HTTP —Å–µ—Ä–≤–µ—Ä –¥–ª—è Socket.IO**

–û—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä –∑–∞–ø—É—Å–∫–∞–µ—Ç HTTP —Å–µ—Ä–≤–µ—Ä –¥–ª—è Socket.IO –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π:

```go
// cmd/indexer-orchestrator/orchestrator.go
startHTTPServer()
  ‚îî‚îÄ‚îÄ –ó–∞–ø—É—Å–∫ Echo —Å–µ—Ä–≤–µ—Ä–∞
      ‚îî‚îÄ‚îÄ routes.Add(e) - –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ Socket.IO –º–∞—Ä—à—Ä—É—Ç–æ–≤
```

#### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏

```bash
indexer-orchestrator \
  --workers 2 \                    # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏
  --server-path ./bin/platform-server \  # –ü—É—Ç—å –∫ platform-server
  --config .env \                  # –§–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
  --servers "wss://s1.ripple.com/,wss://s2.ripple.com/,wss://xrplcluster.com/" \  # XRPL —Å–µ—Ä–≤–µ—Ä—ã
  --check-interval 10s \           # –ò–Ω—Ç–µ—Ä–≤–∞–ª –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç–∞—Ç—É—Å–∞ –≤–æ—Ä–∫–µ—Ä–æ–≤
  --log-file logs/indexer-orchestrator.log  # –ü—É—Ç—å –∫ –ª–æ–≥-—Ñ–∞–π–ª—É
```

#### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

- `XRPL_WEBSOCKET_URL` - —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –≤–æ—Ä–∫–µ—Ä–∞ (–∏–∑ —Å–ø–∏—Å–∫–∞ --servers)
- `CLICKHOUSE_*` - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ ClickHouse (–∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º)
- `SERVER_HOST`, `SERVER_PORT` - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ HTTP —Å–µ—Ä–≤–µ—Ä–∞ –¥–ª—è Socket.IO

#### –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

1. **–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –Ω–æ–¥**: –ö–∞–∂–¥—ã–π –≤–æ—Ä–∫–µ—Ä –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ —Å–≤–æ–µ–º—É XRPL —Å–µ—Ä–≤–µ—Ä—É, —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –ª–µ–¥–∂–µ—Ä—ã –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ –∏ –ø–æ–≤—ã—à–∞–µ—Ç –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å.

2. **–î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π**: –û–¥–Ω–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –º–æ–∂–µ—Ç –ø—Ä–∏–π—Ç–∏ –æ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –≤–æ—Ä–∫–µ—Ä–æ–≤ (–µ—Å–ª–∏ –æ–Ω–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω—ã –∫ —Ä–∞–∑–Ω—ã–º –Ω–æ–¥–∞–º, –Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç –æ–¥–∏–Ω –ª–µ–¥–∂–µ—Ä). –û—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –∫–∞–∂–¥–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑.

3. **–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –∑–∞–ø–∏—Å—å**: –í—Å–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –æ—Ç –≤—Å–µ—Ö –≤–æ—Ä–∫–µ—Ä–æ–≤ –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –≤ –æ–¥–∏–Ω ClickHouse —á–µ—Ä–µ–∑ –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä, —á—Ç–æ —É–ø—Ä–æ—â–∞–µ—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞—Ç—á–∞–º–∏ –∏ –ø—Ä–æ–≤–µ—Ä–∫—É —Ç–æ–∫–µ–Ω–æ–≤.

4. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫**: –ï—Å–ª–∏ –≤–æ—Ä–∫–µ—Ä –ø–∞–¥–∞–µ—Ç, –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç –µ–≥–æ —Å —Ç–µ–º –∂–µ XRPL —Å–µ—Ä–≤–µ—Ä–æ–º.

5. **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–æ–≤ –ø–æ—Å–ª–µ flush**: –¢–æ–∫–µ–Ω—ã –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è –Ω–µ —Å—Ä–∞–∑—É, –∞ –ø–æ—Å–ª–µ flush –±–∞—Ç—á–∞ –≤ ClickHouse, —á—Ç–æ –±–æ–ª–µ–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ.

6. **Socket.IO —Å–æ–±—ã—Ç–∏—è**: –û—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç Socket.IO —Å–æ–±—ã—Ç–∏—è –æ –Ω–æ–≤—ã—Ö —Ç–æ–∫–µ–Ω–∞—Ö –≤—Å–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã–º –∫–ª–∏–µ–Ω—Ç–∞–º.

#### –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

**–ë–∞–∑–æ–≤—ã–π –∑–∞–ø—É—Å–∫ —Å 2 –≤–æ—Ä–∫–µ—Ä–∞–º–∏:**
```bash
./bin/indexer-orchestrator --workers 2 --server-path ./bin/platform-server
```

**–ó–∞–ø—É—Å–∫ —Å 4 –≤–æ—Ä–∫–µ—Ä–∞–º–∏ –∏ 3 —Å–µ—Ä–≤–µ—Ä–∞–º–∏:**
```bash
./bin/indexer-orchestrator \
  --workers 4 \
  --server-path ./bin/platform-server \
  --servers "wss://s1.ripple.com/,wss://s2.ripple.com/,wss://xrplcluster.com/" \
  --check-interval 10s
```

**–ó–∞–ø—É—Å–∫ —Å –∫–∞—Å—Ç–æ–º–Ω—ã–º –ª–æ–≥-—Ñ–∞–π–ª–æ–º:**
```bash
./bin/indexer-orchestrator \
  --workers 2 \
  --log-file /var/log/indexer-orchestrator.log
```

#### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–û—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä –ª–æ–≥–∏—Ä—É–µ—Ç:
- –ó–∞–ø—É—Å–∫ –∏ –æ—Å—Ç–∞–Ω–æ–≤–∫—É –≤–æ—Ä–∫–µ—Ä–æ–≤
- IPC —Å–æ–±—ã—Ç–∏—è –æ—Ç –≤–æ—Ä–∫–µ—Ä–æ–≤
- –û–±—Ä–∞–±–æ—Ç–∫—É —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –∏ –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—é
- –û—à–∏–±–∫–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏
- –ü—Ä–æ–≤–µ—Ä–∫—É –Ω–æ–≤—ã—Ö —Ç–æ–∫–µ–Ω–æ–≤
- Socket.IO —Å–æ–±—ã—Ç–∏—è

–ö–∞–∂–¥—ã–π –≤–æ—Ä–∫–µ—Ä –ø–∏—à–µ—Ç —Å–≤–æ–∏ –ª–æ–≥–∏ –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ñ–∞–π–ª:
- `logs/indexer-worker-1.log`
- `logs/indexer-worker-2.log`
- –∏ —Ç.–¥.

–ü—Ä–∏–º–µ—Ä –ª–æ–≥–∞ –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä–∞:
```
[INDEXER-ORCHESTRATOR] Starting orchestrator with 2 workers
[INDEXER-ORCHESTRATOR] Started worker 1 with PID 12345 on server wss://s1.ripple.com/
[INDEXER-ORCHESTRATOR] Started worker 2 with PID 12346 on server wss://s2.ripple.com/
[INDEXER-ORCHESTRATOR] Worker 1 is ready: map[status:ready]
[INDEXER-ORCHESTRATOR] Worker 2 is ready: map[status:ready]
[INDEXER-ORCHESTRATOR] Sent transactions batch via IPC ledger_index=12345678 txs_sent=15
[INDEXER-ORCHESTRATOR] Emitted new_token_detected event via SocketIO currency=USD issuer=r... ledger_index=12345678
```

#### –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å –ø—Ä–æ—Ü–µ—Å—Å–æ–º –∏–Ω–¥–µ–∫—Å–µ—Ä–∞

–û—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä –∑–∞–ø—É—Å–∫–∞–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å—ã `platform-server --mode indexer` —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏:
- `--mode indexer` - —Ä–µ–∂–∏–º subprocess
- `--config .env` - —Ñ–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- `XRPL_WEBSOCKET_URL` - —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ environment variable

–ü—Ä–æ—Ü–µ—Å—Å—ã —Ä–∞–±–æ—Ç–∞—é—Ç –∫–∞–∫ subprocess –∏ –æ–±—â–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ IPC:
- –í–æ—Ä–∫–µ—Ä –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —á–µ—Ä–µ–∑ stdout
- –û—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä –º–æ–∂–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –∫–æ–º–∞–Ω–¥—ã —á–µ—Ä–µ–∑ stdin (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
- –õ–æ–≥–∏ –≤–æ—Ä–∫–µ—Ä–∞ –ø–∏—à—É—Ç—Å—è –≤ stderr (–ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –≤ –ª–æ–≥-—Ñ–∞–π–ª)

#### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

1. **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å**: –ú–æ–∂–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å N –≤–æ—Ä–∫–µ—Ä–æ–≤ –¥–ª—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å N –Ω–æ–¥
2. **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å**: –ï—Å–ª–∏ –æ–¥–∏–Ω –≤–æ—Ä–∫–µ—Ä –ø–∞–¥–∞–µ—Ç, –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç —Ä–∞–±–æ—Ç–∞—Ç—å
3. **–î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è**: –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –∫–∞–∂–¥–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑
4. **–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–∞—Ü–∏—è**: –£–ø—Ä–æ—â–∞–µ—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ ClickHouse –∏ Socket.IO
5. **–ì–∏–±–∫–æ—Å—Ç—å**: –õ–µ–≥–∫–æ –¥–æ–±–∞–≤–∏—Ç—å/—É–±—Ä–∞—Ç—å –≤–æ—Ä–∫–µ—Ä—ã –±–µ–∑ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –≤—Å–µ–π —Å–∏—Å—Ç–µ–º—ã

---

## üìù –õ–∏—Ü–µ–Ω–∑–∏—è

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è–µ—Ç—Å—è –ø–æ–¥ –ª–∏—Ü–µ–Ω–∑–∏–µ–π GNU General Public License v3.0. –°–º. —Ñ–∞–π–ª [LICENSE](LICENSE) –¥–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–µ–π.

## ü§ù –í–∫–ª–∞–¥ –≤ –ø—Ä–æ–µ–∫—Ç

–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤—É—é—Ç—Å—è pull requests –∏ issues. –ü–µ—Ä–µ–¥ –≤–Ω–µ—Å–µ–Ω–∏–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏–π:

1. –°–æ–∑–¥–∞–π—Ç–µ issue –¥–ª—è –æ–±—Å—É–∂–¥–µ–Ω–∏—è –∫—Ä—É–ø–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π
2. –§–æ—Ä–∫–Ω–∏—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
3. –°–æ–∑–¥–∞–π—Ç–µ –≤–µ—Ç–∫—É –¥–ª—è –≤–∞—à–µ–π —Ñ—É–Ω–∫—Ü–∏–∏ (`git checkout -b feature/amazing-feature`)
4. –ó–∞–∫–æ–º–º–∏—Ç—å—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è (`git commit -m 'Add amazing feature'`)
5. –ó–∞–ø—É—à—å—Ç–µ –≤ –≤–µ—Ç–∫—É (`git push origin feature/amazing-feature`)
6. –û—Ç–∫—Ä–æ–π—Ç–µ Pull Request

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–î–ª—è –≤–æ–ø—Ä–æ—Å–æ–≤ –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ —Å–æ–∑–¥–∞–π—Ç–µ issue –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞.

## üîó –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- [XRPL Documentation](https://xrpl.org/)
- [ClickHouse Documentation](https://clickhouse.com/docs)
- [Go Documentation](https://go.dev/doc/)
- [Echo Framework](https://echo.labstack.com/)
- [Socket.IO](https://socket.io/)

---

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ**: –≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –∞–∫—Ç–∏–≤–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ. API –∏ —Å—Ö–µ–º–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –º–æ–≥—É—Ç –∏–∑–º–µ–Ω—è—Ç—å—Å—è –º–µ–∂–¥—É –≤–µ—Ä—Å–∏—è–º–∏.